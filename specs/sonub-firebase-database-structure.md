---
name: sonub
version: 1.0.0
description: Firebase Realtime Database κµ¬μ΅° κ°€μ΄λ“ λ¬Έμ„μ SED μ‚¬μ–‘
author: JaeHo Song
email: thruthesky@gmail.com
homepage: https://github.com/thruthesky/
funding: ""
license: GPL-3.0
dependencies: []
---

- [Firebase Realtime Database κµ¬μ΅° κ°€μ΄λ“](#firebase-realtime-database-κµ¬μ΅°-κ°€μ΄λ“)
  - [μ›ν¬ν”λ΅μ°](#μ›ν¬ν”λ΅μ°)
    - [π“‹ λ¬Έμ„μ λ²”μ„](#-λ¬Έμ„μ-λ²”μ„)
    - [π”€ ν΄λΌμ΄μ–ΈνΈμ™€ λ°±μ—”λ“μ λ°μ΄ν„° μ±…μ„ κµ¬λ¶„](#-ν΄λΌμ΄μ–ΈνΈμ™€-λ°±μ—”λ“μ-λ°μ΄ν„°-μ±…μ„-κµ¬λ¶„)
    - [ν΄λΌμ΄μ–ΈνΈμ™€ λ°±μ—”λ“μ μ—­ν•  λ¶„λ¦¬](#ν΄λΌμ΄μ–ΈνΈμ™€-λ°±μ—”λ“μ-μ—­ν• -λ¶„λ¦¬)
  - [κ°μ”](#κ°μ”)
  - [λ°μ΄ν„°λ² μ΄μ¤ μ „μ²΄ κµ¬μ΅°](#λ°μ΄ν„°λ² μ΄μ¤-μ „μ²΄-κµ¬μ΅°)
  - [μ‚¬μ©μ μ •λ³΄ (users)](#μ‚¬μ©μ-μ •λ³΄-users)
    - [μ‚¬μ©μ Realtime Database λ°μ΄ν„° κµ¬μ΅°](#μ‚¬μ©μ-realtime-database-λ°μ΄ν„°-κµ¬μ΅°)
    - [ν•„λ“ μ„¤λ…](#ν•„λ“-μ„¤λ…)
    - [ν΄λΌμ΄μ–ΈνΈ/μ„λ²„ μ—­ν•  λ¶„λ¦¬](#ν΄λΌμ΄μ–ΈνΈμ„λ²„-μ—­ν• -λ¶„λ¦¬)
    - [β οΈ μ¤‘μ”: Firebase Auth vs RTDB ν•„λ“](#οΈ-μ¤‘μ”-firebase-auth-vs-rtdb-ν•„λ“)
    - [κ΄€λ ¨ κ°€μ΄λ“](#κ΄€λ ¨-κ°€μ΄λ“)
  - [μ‚¬μ©μ μ†μ„± λ¶„λ¦¬ (user-props)](#μ‚¬μ©μ-μ†μ„±-λ¶„λ¦¬-user-props)
    - [λ°μ΄ν„° κµ¬μ΅°](#λ°μ΄ν„°-κµ¬μ΅°)
    - [ν΄λΌμ΄μ–ΈνΈ/μ„λ²„ μ—­ν•  λ¶„λ¦¬](#ν΄λΌμ΄μ–ΈνΈμ„λ²„-μ—­ν• -λ¶„λ¦¬-1)
    - [κ΄€λ ¨ κ°€μ΄λ“](#κ΄€λ ¨-κ°€μ΄λ“-1)
  - [μΉκµ¬ κ΄€κ³„ (friends, followers, following)](#μΉκµ¬-κ΄€κ³„-friends-followers-following)
    - [λ°μ΄ν„° κµ¬μ΅°](#λ°μ΄ν„°-κµ¬μ΅°-1)
    - [μ„¤λ…](#μ„¤λ…)
    - [ν΄λΌμ΄μ–ΈνΈ/μ„λ²„ μ—­ν•  λ¶„λ¦¬](#ν΄λΌμ΄μ–ΈνΈμ„λ²„-μ—­ν• -λ¶„λ¦¬-2)
    - [κ΄€λ ¨ κ°€μ΄λ“](#κ΄€λ ¨-κ°€μ΄λ“-2)
  - [μ£Όμ” μ„¤κ³„ μ›μΉ™](#μ£Όμ”-μ„¤κ³„-μ›μΉ™)
    - [1. Flat Style κµ¬μ΅°](#1-flat-style-κµ¬μ΅°)
    - [2. μ†μ„± λ¶„λ¦¬](#2-μ†μ„±-λ¶„λ¦¬)
    - [3. Cloud Functions ν™μ©](#3-cloud-functions-ν™μ©)
    - [4. λ³΄μ• κ·μΉ™](#4-λ³΄μ•-κ·μΉ™)
  - [μ£Όμμ‚¬ν•­](#μ£Όμμ‚¬ν•­)
    - [Firebase Auth vs RTDB ν•„λ“λ… μ°¨μ΄](#firebase-auth-vs-rtdb-ν•„λ“λ…-μ°¨μ΄)
  - [κ΄€λ ¨ κ°€μ΄λ“ λ¬Έμ„](#κ΄€λ ¨-κ°€μ΄λ“-λ¬Έμ„)
  - [μ°Έκ³  μλ£](#μ°Έκ³ -μλ£)


## Overview
- μ΄ λ¬Έμ„λ” "Firebase Realtime Database κµ¬μ΅° κ°€μ΄λ“"μ— λ€ν• μ„Έλ¶€ μ‚¬μ–‘μ„ μ •λ¦¬ν•λ©°, κΈ°μ΅΄ λ‚΄μ©μ„ κ·Έλ€λ΅ μ μ§€ν• μ±„ SED κµ¬μ΅°μ— λ§μ¶° μ κ³µν•©λ‹λ‹¤.

## Requirements
- λ¬Έμ„ μ „λ°μ— κ±Έμ³ μ†κ°λλ” μ§€μΉ¨κ³Ό μ°Έκ³  μ‚¬ν•­μ„ λ¨λ‘ μ™μ§€ν•΄μ•Ό ν•λ©°, λ³„λ„μ μ¶”κ°€ μ„ ν–‰ μ΅°κ±΄μ€ μ›λ¬Έ κ° μ μ—μ„ μ μ‹λλ” λ‚΄μ©μ„ λ”°λ¦…λ‹λ‹¤.

## Workflow
1. μ•„λ `## Detail Items` μ μ— ν¬ν•¨λ μ›λ¬Έ λ©μ°¨λ¥Ό κ²€ν† ν•©λ‹λ‹¤.
2. ν•„μ”ν• κ²½μ° μ›λ¬Έμ κ° μ μ„ μμ„λ€λ΅ μ½μΌλ©° ν”„λ΅μ νΈ μ‘μ—… νλ¦„μ— λ°μν•©λ‹λ‹¤.
3. λ¬Έμ„μ— λ…μ‹λ λ¨λ“  μ§€μΉ¨μ„ ν™•μΈν• λ’¤ μ‹¤μ  κ°λ° λ‹¨κ³„μ— μ μ©ν•©λ‹λ‹¤.

## Detail Items
- μ΄ν•μ—λ” κΈ°μ΅΄ λ¬Έμ„μ λ¨λ“  λ‚΄μ©μ„ μ›ν• κ·Έλ€λ΅ ν¬ν•¨ν•μ—¬ μ°Έμ΅°ν•  μ μλ„λ΅ κµ¬μ„±ν–μµλ‹λ‹¤.

# Firebase Realtime Database κµ¬μ΅° κ°€μ΄λ“

λ³Έ λ¬Έμ„λ” SNS μ›Ή μ• ν”λ¦¬μΌ€μ΄μ…μ Firebase Realtime Database μ¤ν‚¤λ§ μ •μλ¥Ό μ κ³µν•©λ‹λ‹¤.
κ° κΈ°λ¥μ μƒμ„Έν• κµ¬ν„ λ°©λ²•μ€ ν•΄λ‹Ή κ°€μ΄λ“ λ¬Έμ„λ¥Ό μ°Έκ³ ν•μ„Έμ”.

## μ›ν¬ν”λ΅μ°

### π“‹ λ¬Έμ„μ λ²”μ„

λ³Έ λ¬Έμ„λ” **λ°μ΄ν„°λ² μ΄μ¤ κµ¬μ΅°(μ¤ν‚¤λ§)μ™€ κµ¬μ΅°μ— λ€ν• μ„¤λ…λ§** ν¬ν•¨ν•©λ‹λ‹¤.

- β… **ν¬ν•¨λλ” λ‚΄μ©**:
  - Firebase Realtime Database κ²½λ΅ λ° κµ¬μ΅° μ •μ
  - κ° ν•„λ“μ νƒ€μ… λ° μ„¤λ…
  - λ°μ΄ν„° κµ¬μ΅° μμ‹
  - ν΄λΌμ΄μ–ΈνΈ/λ°±μ—”λ“ μ—­ν•  κµ¬λ¶„ (μ–΄λ–¤ ν•„λ“λ¥Ό λ„κ°€ μ €μ¥ν•λ”μ§€)

- β **ν¬ν•¨λμ§€ μ•λ” λ‚΄μ©**:
  - κµ¬μ²΄μ μΈ κµ¬ν„ μ½”λ“ μμ  (TypeScript, JavaScript)
  - μΌ€μ΄μ¤λ³„ μƒμ„Έ μ„¤λ… λ° μ‚¬μ© μμ‹
  - API ν•¨μ μ‚¬μ©λ²•

**κµ¬ν„ μμ μ™€ μƒμ„Έ μ„¤λ…**μ€ λ‹¤μ κ°λ³„ κ°€μ΄λ“ λ¬Έμ„λ¥Ό μ°Έκ³ ν•μ„Έμ”:
- [Firebase Cloud Functions κ°λ° κ°€μ΄λ“](./sns-firebase-cloud-functions.md) - Cloud Functions κµ¬ν„ μμ 

### π”€ ν΄λΌμ΄μ–ΈνΈμ™€ λ°±μ—”λ“μ λ°μ΄ν„° μ±…μ„ κµ¬λ¶„

**λ§¤μ° μ¤‘μ”**: DB κµ¬μ΅°μ κ° ν•„λ“λ” **ν΄λΌμ΄μ–ΈνΈκ°€ μ €μ¥**ν•κ±°λ‚ **λ°±μ—”λ“κ°€ μ—…λ°μ΄νΈ**ν•λ„λ΅ λ…ν™•ν κµ¬λ¶„λμ–΄ μμµλ‹λ‹¤.

| ν•„λ“ μ ν• | μ±…μ„ μ£Όμ²΄ | μμ‹ ν•„λ“ |
|----------|---------|----------|
| **μ‚¬μ©μ μ…λ ¥ λ°μ΄ν„°** | ν΄λΌμ΄μ–ΈνΈλ§ μ €μ¥ | `title`, `content`, `uid`, `createdAt` |
| **μΉ΄μ΄ν„° ν•„λ“** | λ°±μ—”λ“λ§ μ—…λ°μ΄νΈ | `likeCount`, `commentCount`, `postCount` |
| **ν†µκ³„ λ° μ§‘κ³„** | λ°±μ—”λ“λ§ μ—…λ°μ΄νΈ | `/stats/counters/*`, `/categories/{category}/postCount` |
| **μ†μ„± λ¶„λ¦¬ λ°μ΄ν„°** | λ°±μ—”λ“λ§ λ™κΈ°ν™” | `/user-props/displayName/{uid}` |

β οΈ **κ°λ° μ‹ ν•„μ μ¤€μ μ‚¬ν•­**:
- ν΄λΌμ΄μ–ΈνΈλ” **μ λ€λ΅** μΉ΄μ΄ν„° ν•„λ“λ¥Ό μ§μ ‘ μ¦κ°€/κ°μ†μ‹ν‚¤μ§€ μ•μµλ‹λ‹¤
- ν΄λΌμ΄μ–ΈνΈλ” **μ λ€λ΅** ν†µκ³„ λ°μ΄ν„°λ¥Ό μ§μ ‘ κ³„μ‚°ν•μ—¬ μ €μ¥ν•μ§€ μ•μµλ‹λ‹¤
- λ°±μ—”λ“(Cloud Functions)λ§μ΄ μΉ΄μ΄ν„°, ν†µκ³„, μ†μ„± λ¶„λ¦¬ μ‘μ—…μ„ μν–‰ν•©λ‹λ‹¤

**β οΈ μ¤‘μ” μ›μΉ™**: μ›Ή/μ•± ν΄λΌμ΄μ–ΈνΈμ—μ„λ” **μµμ†ν•μ μ •λ³΄λ§ RTDBμ— κΈ°λ΅**ν•κ³ , **μ¶”κ°€μ μΈ μ •λ³΄ μ—…λ°μ΄νΈλ” Firebase Cloud Functions λ°±μ—”λ“μ—μ„ μ²λ¦¬**ν•©λ‹λ‹¤.

### ν΄λΌμ΄μ–ΈνΈμ™€ λ°±μ—”λ“μ μ—­ν•  λ¶„λ¦¬

**ν΄λΌμ΄μ–ΈνΈμ μ—­ν•  (μµμ†ν•μ λ°μ΄ν„°λ§ μ €μ¥):**
- β… μ‚¬μ©μκ°€ μ§μ ‘ μ…λ ¥ν• λ°μ΄ν„°λ§ RTDBμ— μ €μ¥ν•©λ‹λ‹¤ (μ: κ²μ‹κΈ€ μ λ©, λ‚΄μ©, λ“κΈ€ λ‚΄μ©)
- β… κΈ°λ³Έμ μΈ λ©”νƒ€λ°μ΄ν„°λ§ ν¬ν•¨ν•©λ‹λ‹¤ (μ: uid, createdAt, category)
- β μΉ΄μ΄ν„° μ¦κ°€/κ°μ†λ¥Ό μ§μ ‘ μ²λ¦¬ν•μ§€ μ•μµλ‹λ‹¤ (μ: likeCount, commentCount)
- β λ°μ΄ν„° μ§‘κ³„ λ° ν†µκ³„λ¥Ό μ§μ ‘ κ³„μ‚°ν•μ§€ μ•μµλ‹λ‹¤ (μ: stats/counters, categories)
- β μ†μ„± λ¶„λ¦¬ μ‘μ—…μ„ μ§μ ‘ ν•μ§€ μ•μµλ‹λ‹¤ (μ: user-props/)

**λ°±μ—”λ“(Cloud Functions)μ μ—­ν•  (μλ™ λ°μ΄ν„° μ²λ¦¬):**
- β… ν΄λΌμ΄μ–ΈνΈκ°€ μ €μ¥ν• λ°μ΄ν„°λ¥Ό κ°μ§€ν•μ—¬ μ¶”κ°€ λ°μ΄ν„°λ¥Ό μλ™μΌλ΅ μ—…λ°μ΄νΈν•©λ‹λ‹¤
- β… μΉ΄μ΄ν„° μλ™ μ¦κ°€/κ°μ† (μ: likeCount, commentCount, postCount)
- β… μ „μ²΄ ν†µκ³„ μλ™ μ§‘κ³„ (μ: stats/counters/like, stats/counters/post)
- β… μ‚¬μ©μ μ†μ„± λ¶„λ¦¬ μλ™ λ™κΈ°ν™” (μ: /users/{uid} β†’ /user-props/displayName/{uid})
- β… λ°μ΄ν„° λ¬΄κ²°μ„± λ³΄μ¥ (μ: κ²μ‹κΈ€ μ‚­μ  μ‹ κ΄€λ ¨ λ“κΈ€/μΆ‹μ•„μ” μ •λ¦¬)

**κµ¬μ²΄μ μΈ μμ‹**λ” λ‹¤μ κ°€μ΄λ“ λ¬Έμ„λ¥Ό μ°Έκ³ ν•μ„Έμ”:
- [Firebase Cloud Functions κ°λ° κ°€μ΄λ“](./sns-firebase-cloud-functions.md)

μ΄λ¬ν• μ—­ν•  λ¶„λ¦¬λ¥Ό ν†µν•΄ λ‹¤μκ³Ό κ°™μ€ μ΄μ μ„ μ–»μ„ μ μμµλ‹λ‹¤:
- π”’ **λ°μ΄ν„° λ¬΄κ²°μ„±**: λ°±μ—”λ“μ—μ„ μΌκ΄€λκ² μ²λ¦¬ν•μ—¬ μ¤‘λ³µ μ¦κ°€/κ°μ† λ°©μ§€
- β΅ **μ„±λ¥ μµμ ν™”**: ν΄λΌμ΄μ–ΈνΈλ” λ‹¨μ μ‘μ—…λ§ μν–‰ν•μ—¬ λΉ λ¥Έ μ‘λ‹µ
- π”§ **μ μ§€λ³΄μμ„±**: λΉ„μ¦λ‹μ¤ λ΅μ§μ΄ λ°±μ—”λ“μ— μ§‘μ¤‘λμ–΄ κ΄€λ¦¬ μ©μ΄
- π **ν”λ«νΌ λ…λ¦½μ„±**: μ›Ή/μ•± λ¨λ‘ λ™μΌν• λ°±μ—”λ“ λ΅μ§ κ³µμ 


---

## κ°μ”

- Firebase Realtime Database(RTDB)λ” μ‹¤μ‹κ°„ λ°μ΄ν„° λ™κΈ°ν™”κ°€ ν•„μ”ν• SNS μ›Ή μ• ν”λ¦¬μΌ€μ΄μ…μ— μ ν•©ν•©λ‹λ‹¤.
- λ°μ΄ν„°λ” **flat style** κµ¬μ΅°λ΅ μ €μ¥λμ–΄ μΏΌλ¦¬ ν¨μ¨μ„±μ„ κ·Ήλ€ν™”ν•©λ‹λ‹¤.
- μ• ν”λ¦¬μΌ€μ΄μ…μ—μ„λ” ν•„μ”ν• μµμ†ν•μ λ°μ΄ν„°λ§ μ €μ¥ν•κ³ , Firebase Cloud Functionsλ¥Ό μ‚¬μ©ν•μ—¬ λ³µμ΅ν• λ°μ΄ν„° μ²λ¦¬ λ° μ§‘κ³„λ¥Ό μν–‰ν•©λ‹λ‹¤.

---

## λ°μ΄ν„°λ² μ΄μ¤ μ „μ²΄ κµ¬μ΅°

```
Firebase Realtime Database (λ£¨νΈ)
β”β”€β”€ users/                    # μ‚¬μ©μ ν”„λ΅ν•„
β”β”€β”€ user-props/               # μ‚¬μ©μ μ†μ„± (λ€λ‰ μΏΌλ¦¬ μµμ ν™”)
β”β”€β”€ friends/                  # μΉκµ¬ κ΄€κ³„
β”β”€β”€ followers/                # ν”λ΅μ› (λ‚λ¥Ό ν”λ΅μ°ν•λ” μ‚¬μ©μ)
β”β”€β”€ following/                # ν”λ΅μ‰ (λ‚΄κ°€ ν”λ΅μ°ν•λ” μ‚¬μ©μ)
β”β”€β”€ chat-messages/            # μ±„ν… λ©”μ‹μ§€ (κ²μ‹κΈ€ + λ“κΈ€ μ—­ν•  ν†µν•©)
β”β”€β”€ chat-joins/               # μ±„ν…λ°© μ°Έμ—¬ μ •λ³΄ (μ±„ν…λ°© λ©λ΅μ©)
β””β”€β”€ stats/                    # μ „μ—­ ν†µκ³„
    β””β”€β”€ counters/
        β””β”€β”€ user              # μ „μ²΄ μ‚¬μ©μ μ (Cloud Functionsμ—μ„λ§ μ¦κ°€)
```

---

## ν†µκ³„ (stats/counters)

μ „μ²΄ ν†µκ³„ κ°’μ€ `/stats/counters/` κ²½λ΅μ—μ„ κ΄€λ¦¬ν•λ©°, **λ°±μ—”λ“(Cloud Functions)λ§** μ“°κΈ°κ°€ κ°€λ¥ν•©λ‹λ‹¤.

### μ‚¬μ©μ μ ν†µκ³„ κµ¬μ΅°

```
/stats/
  /counters/
    user: number   // μ „μ²΄ κ°€μ… μ‚¬μ©μ μ
```

### λ™μ‘ λ°©μ‹

- μƒ μ‚¬μ©μκ°€ μƒμ„±λλ©΄ `firebase/functions/src/handlers/user.handler.ts`μ `handleUserCreate()`κ°€ μ‹¤ν–‰λ©λ‹λ‹¤.
- ν•΄λ‹Ή λ΅μ§μ€ `/stats/counters/user` κ°’μ„ `ServerValue.increment(1)`λ΅ μ¦κ°€μ‹μΌ λ™μ‹μ„± λ¬Έμ  μ—†μ΄ μ΄ μ‚¬μ©μ μλ¥Ό μ§‘κ³„ν•©λ‹λ‹¤.
- ν΄λΌμ΄μ–ΈνΈλ” μ΄ κ°’μ„ μ½κΈ°λ§ ν•λ©°, μ“°κΈ°λ” κΈμ§€λ©λ‹λ‹¤.

### ν™μ© μμ‹

- ν™νμ΄μ§€ μ°μΈ΅ μ‚¬μ΄λ“λ°”μ ν†µκ³„ μΉ΄λ“
- `/stats` νμ΄μ§€μ—μ„ μ κ³µν•λ” μ‚¬μ©μ μ λ€μ‹λ³΄λ“

---

## μ‚¬μ©μ μ •λ³΄ (users)

μ‚¬μ©μ ν”„λ΅ν•„ μ •λ³΄λ” `/users/<uid>/` κ²½λ΅μ— μ €μ¥λ©λ‹λ‹¤.

### μ‚¬μ©μ Realtime Database λ°μ΄ν„° κµ¬μ΅°


μ‚¬μ©μ ν”„λ΅ν•„ λ°μ΄ν„°μ μ €μ¥ κµ¬μ΅°λ” λ‹¤μκ³Ό κ°™μµλ‹λ‹¤:

```
/users/
β”β”€β”€ <uid1>/
β”‚   β”β”€β”€ displayName: "μ‚¬μ©μ1"
β”‚   β”β”€β”€ photoUrl: "https://firebasestorage.googleapis.com/..."
β”‚   β”β”€β”€ gender: "M"
β”‚   β”β”€β”€ birthYear: 1990
β”‚   β”β”€β”€ birthMonth: 1
β”‚   β”β”€β”€ birthDay: 15
β”‚   β”β”€β”€ birthYearMonthDay: "1990-01-15"
β”‚   β”β”€β”€ birthMonthDay: "01-15"
β”‚   β”β”€β”€ bio: "μκΈ°μ†κ°"
β”‚   β”β”€β”€ createdAt: 1698473000000
β”‚   β””β”€β”€ updatedAt: 1698474000000
β””β”€β”€ <uid2>/
    β”β”€β”€ displayName: "μ‚¬μ©μ2"
    β”β”€β”€ photoUrl: null
    β”β”€β”€ gender: "F"
    β”β”€β”€ createdAt: 1698473100000
    β””β”€β”€ updatedAt: 1698474100000
```

### ν•„λ“ μ„¤λ…

| ν•„λ“ | νƒ€μ… | ν•„μ | μ„¤λ… |
|------|------|------|------|
| `displayName` | string | β… | μ‚¬μ©μ λ‹‰λ„¤μ„ |
| `photoUrl` | string | β | ν”„λ΅ν•„ μ‚¬μ§„ URL |
| `gender` | (M|F) | β | μ„±λ³„ |
| `birthYear` | number | β | μƒλ…„ |
| `birthMonth` | number | β | μƒμ›” |
| `birthDay` | number | β | μƒμΌ |
| `birthYearMonthDay` | string | β | μƒλ…„μ›”μΌ (YYYY-MM-DD) |
| `birthMonthDay` | string | β | μƒμ›”μΌ (MM-DD)
| `bio` | string | β | μκΈ°μ†κ° |
| `createdAt` | number | β… | κ³„μ • μƒμ„± μ‹κ°„ |
| `updatedAt` | number | β… | ν”„λ΅ν•„ μμ • μ‹κ°„ |

### ν΄λΌμ΄μ–ΈνΈ/μ„λ²„ μ—­ν•  λ¶„λ¦¬

μ‚¬μ©μ μ •λ³΄μ κ²½μ°:
- **ν΄λΌμ΄μ–ΈνΈλ”** `displayName`, `photoUrl`, `gender`, `birthYear`, `birthMonth`, `birthDay`, `bio` λ¥Ό μ €μ¥ν•  μ μκ³ ,
- **μ„λ²„λ”** `createdAt` κ³Ό `updatedAt` λ§ μ €μ¥ν•  μ μμµλ‹λ‹¤.

### β οΈ μ¤‘μ”: Firebase Auth vs RTDB ν•„λ“

**/users/<uid> λ…Έλ“μ—λ” Firebase Auth μ •λ³΄λ¥Ό μ €μ¥ν•μ§€ μ•μµλ‹λ‹¤:**

Firebase Authenticationμ λ‹¤μ ν•„λ“λ“¤μ€ `/users/<uid>` λ…Έλ“μ— **μ €μ¥ν•μ§€ μ•μµλ‹λ‹¤**:
- β `phoneNumber` - Firebase Authμ—μ„λ§ κ΄€λ¦¬
- β `email` - Firebase Authμ—μ„λ§ κ΄€λ¦¬
- β `photoURL` (λ€λ¬Έμ URL) - Firebase Authμ—μ„λ§ κ΄€λ¦¬

μ΄λ“¤ μ •λ³΄λ” `login` μΈμ¤ν„΄μ¤λ¥Ό ν†µν•΄ μ ‘κ·Όν•  μ μμµλ‹λ‹¤. μμ„Έν• μ‚¬μ©λ²•μ€ [μ½”λ”© κ°€μ΄λ“λΌμΈ - Firebase λ΅κ·ΈμΈ μ‚¬μ©μ κ΄€λ¦¬](./sns-web-coding-guideline.md#firebase-λ΅κ·ΈμΈ-μ‚¬μ©μ-κ΄€λ¦¬-login)λ¥Ό μ°Έκ³ ν•μ„Έμ”.

**λ‹¨, `photoUrl`(camelCase)μ€ μμ™Έμ…λ‹λ‹¤:**

- β… **`photoUrl`** (camelCase) - μ‚¬μ©μκ°€ μ§μ ‘ μ—…λ΅λ“ν• ν”„λ΅ν•„ μ‚¬μ§„ URLμ„ RTDBμ— μ €μ¥
- μ΄λ” Firebase Authμ `photoURL`(λ€λ¬Έμ)κ³Ό **λ‹¤λ¥Έ ν•„λ“**μ…λ‹λ‹¤
- μ‚¬μ©μκ°€ Firebase Storageμ— μ‚¬μ§„μ„ μ—…λ΅λ“ν•λ©΄, λ‹¤μ΄λ΅λ“ URLμ„ `/users/<uid>/photoUrl`μ— μ €μ¥ν•©λ‹λ‹¤

**ν•„λ“λ… μ°¨μ΄ μ”μ•½:**

| ν•„λ“ | μ„μΉ | μ„¤λ… |
|------|------|------|
| `phoneNumber` | Firebase Auth | μ „ν™”λ²νΈ (login.phoneNumberλ΅ μ ‘κ·Ό) |
| `email` | Firebase Auth | μ΄λ©”μΌ (login.emailλ΅ μ ‘κ·Ό) |
| `photoURL` (λ€λ¬Έμ) | Firebase Auth | Firebase Auth ν”„λ΅ν•„ μ‚¬μ§„ |
| `photoUrl` (camelCase) | RTDB | μ‚¬μ©μ μ—…λ΅λ“ ν”„λ΅ν•„ μ‚¬μ§„ (login.data.photoUrlλ΅ μ ‘κ·Ό) |

μμ„Έν• λ‚΄μ©μ€ [μ‚¬μ©μ κ΄€λ¦¬ κ°λ° κ°€μ΄λ“](./sns-web-user.md)μ™€ [μ½”λ”© κ°€μ΄λ“λΌμΈ](./sns-web-coding-guideline.md#firebase-λ΅κ·ΈμΈ-μ‚¬μ©μ-κ΄€λ¦¬-login)μ„ μ°Έκ³ ν•μ„Έμ”.

### κ΄€λ ¨ κ°€μ΄λ“

- **π“– κµ¬ν„ κ°€μ΄λ“**: [μ‚¬μ©μ κ΄€λ¦¬ κ°λ° κ°€μ΄λ“](./sns-web-user.md) - ν”„λ΅ν•„ κ΄€λ¦¬, ν”„λ΅ν•„ μ‚¬μ§„ μ—…λ΅λ“, μ‚¬μ©μ μ •λ³΄ μ΅°ν
- **π“– νμΌ μ—…λ΅λ“**: [νμΌ λ° μ‚¬μ§„ μ—…λ΅λ“ κ°€μ΄λ“](./sns-web-storage.md) - ν”„λ΅ν•„ μ‚¬μ§„ Firebase Storage μ—…λ΅λ“
- **π“– λ³΄μ•**: [Firebase λ³΄μ• κ·μΉ™ κ°λ° κ°€μ΄λ“](./sns-web-security.md) - μ‚¬μ©μ ν”„λ΅ν•„ μ ‘κ·Ό μ μ–΄

---

## μ‚¬μ©μ μ†μ„± λ¶„λ¦¬ (user-props)

νΉμ • μ†μ„±μ— λ€ν• λ€λ‰ μ΅°νλ¥Ό ν¨μ¨μ μΌλ΅ μν–‰ν•κΈ° μ„ν•΄ μ‚¬μ©μ μ†μ„±μ„ λ³„λ„λ΅ κ΄€λ¦¬ν•©λ‹λ‹¤.

### λ°μ΄ν„° κµ¬μ΅°

```
/user-props/
  /displayName/
    β”β”€β”€ <uid1>: "μ‚¬μ©μ1"
    β”β”€β”€ <uid2>: "μ‚¬μ©μ2"
    β””β”€β”€ <uid3>: "μ‚¬μ©μ3"
  /photoUrl/
    β”β”€β”€ <uid1>: "https://..."
    β”β”€β”€ <uid2>: null
    β””β”€β”€ <uid3>: "https://..."
  /createdAt/
    β”β”€β”€ <uid1>: 1698473000000
    β”β”€β”€ <uid2>: 1698473100000
    β””β”€β”€ <uid3>: 1698473200000
  /updatedAt/
    β”β”€β”€ <uid1>: 1698474000000
    β”β”€β”€ <uid2>: 1698474100000
    β””β”€β”€ <uid3>: 1698474200000
```

### ν΄λΌμ΄μ–ΈνΈ/μ„λ²„ μ—­ν•  λ¶„λ¦¬

μ‚¬μ©μ μ†μ„± λ¶„λ¦¬μ κ²½μ°:
- **ν΄λΌμ΄μ–ΈνΈλ”** μ§μ ‘ μ €μ¥ν•μ§€ μ•μΌλ©°, `/users/<uid>` λ…Έλ“μ ν•„λ“λ¥Ό μμ •ν•©λ‹λ‹¤.
- **μ„λ²„λ”** `/users/<uid>` λ…Έλ“μ λ³€κ²½μ„ κ°μ§€ν•μ—¬ `/user-props/displayName/<uid>`, `/user-props/photoUrl/<uid>` λ“±μ ν•„λ“λ¥Ό μλ™μΌλ΅ λ™κΈ°ν™”ν•©λ‹λ‹¤. (Cloud Functions)

### κ΄€λ ¨ κ°€μ΄λ“

- **π“– κµ¬ν„ κ°€μ΄λ“**: [μ‚¬μ©μ κ΄€λ¦¬ κ°λ° κ°€μ΄λ“ - μ‚¬μ©μ μ†μ„± λ¶„λ¦¬](./sns-web-user.md#μ‚¬μ©μ-μ†μ„±-λ¶„λ¦¬-user-props) - μ†μ„± λ¶„λ¦¬ μ „λµ, ν¨μ¨μ μΈ λ€λ‰ μ΅°ν λ°©λ²•

---

## μΉκµ¬ κ΄€κ³„ (friends, followers, following)

μ‚¬μ©μ κ°„μ κ΄€κ³„λ¥Ό κ΄€λ¦¬ν•©λ‹λ‹¤.

### λ°μ΄ν„° κµ¬μ΅°

```
/friends/
  <uid>/
    β”β”€β”€ <other-uid1>: 1698473000000
    β”β”€β”€ <other-uid2>: 1698473100000
    β””β”€β”€ ...

/followers/
  <uid>/
    β”β”€β”€ <follower-uid1>: 1698473000000
    β””β”€β”€ ...

/following/
  <uid>/
    β”β”€β”€ <following-uid1>: 1698473000000
    β””β”€β”€ ...
```

### μ„¤λ…

- **friends**: μƒνΈ μΉκµ¬ κ΄€κ³„ (μ–‘λ°©ν–¥)
- **followers**: λ‚λ¥Ό ν”λ΅μ°ν•λ” μ‚¬μ©μ (λ‹¨λ°©ν–¥ μμ‹ )
- **following**: λ‚΄κ°€ ν”λ΅μ°ν•λ” μ‚¬μ©μ (λ‹¨λ°©ν–¥ λ°μ‹ )
- κ° κ°’μ€ κ΄€κ³„ ν•μ„± μ‹κ°„ (Unix timestamp, λ°€λ¦¬μ΄)

### ν΄λΌμ΄μ–ΈνΈ/μ„λ²„ μ—­ν•  λ¶„λ¦¬

μΉκµ¬ κ΄€κ³„μ κ²½μ°:
- **ν΄λΌμ΄μ–ΈνΈλ”** `/friends/<uid>/<other-uid>`, `/followers/<uid>/<follower-uid>`, `/following/<uid>/<following-uid>` λ…Έλ“λ¥Ό μ¶”κ°€/μ‚­μ ν•μ—¬ μΉκµ¬ κ΄€κ³„λ¥Ό μ”μ²­ν•  μ μκ³ ,
- **μ„λ²„λ”** μΉκµ¬ μ¶”κ°€/μ‚­μ  μ‹ μ–‘λ°©ν–¥ κ΄€κ³„ λ™κΈ°ν™”λ¥Ό μλ™μΌλ΅ μ²λ¦¬ν•©λ‹λ‹¤. (Cloud Functions)
  - μ: Aκ°€ Bλ¥Ό ν”λ΅μ°ν•λ©΄ `/following/<A-uid>/<B-uid>`μ™€ `/followers/<B-uid>/<A-uid>`κ°€ λ¨λ‘ μ—…λ°μ΄νΈλ¨

### κ΄€λ ¨ κ°€μ΄λ“

- **π“– κµ¬ν„ κ°€μ΄λ“**: [μΉκµ¬ κ΄€κ³„ κ΄€λ¦¬ κ°λ° κ°€μ΄λ“](./sns-web-friends.md) - μΉκµ¬ μ¶”κ°€, ν”λ΅μ°, μ–Έν”λ΅μ°, μΉκµ¬ λ©λ΅ μ΅°ν
- **π“– μ‚¬μ©μ μ •λ³΄**: [μ‚¬μ©μ κ΄€λ¦¬ κ°λ° κ°€μ΄λ“](./sns-web-user.md) - μ‚¬μ©μ ν”„λ΅ν•„ μ΅°ν, κΈ°λ³Έ μ •λ³΄
- **π“– λ³΄μ• κ·μΉ™**: [Firebase λ³΄μ• κ·μΉ™ κ°λ° κ°€μ΄λ“](./sns-web-security.md) - μΉκµ¬ κ΄€κ³„ μ ‘κ·Ό μ μ–΄

---

## μ±„ν…λ°© (chat-rooms)

μ±„ν…λ°© λ©”νƒ€λ°μ΄ν„°λ” `/chat-rooms/<roomId>/` κ²½λ΅μ— μ €μ¥λ©λ‹λ‹¤. ν΄λΌμ΄μ–ΈνΈλ” λ°© μ΄λ¦„, μ„¤λ…, κ³µκ° μ—¬λ¶€ λ“± κΈ°λ³Έ μ •λ³΄μ™€ ν•¨κ» `owner` ν•„λ“λ¥Ό μ„¤μ •ν•λ©°, λ³΄μ• κ·μΉ™μ΄ `owner`κ°€ `auth.uid`μ™€ μΌμΉν•λ”μ§€ κ²€μ¦ν•©λ‹λ‹¤. Cloud Functionsλ” `createdAt`, `members` (owner μλ™ μ¶”κ°€), `memberCount` ν•„λ“λ¥Ό μλ™μΌλ΅ μƒμ„±ν•κ³ , `members` ν•„λ“ λ³€κ²½ μ‹ `memberCount`λ¥Ό μλ™μΌλ΅ λ™κΈ°ν™”ν•©λ‹λ‹¤. ν΄λΌμ΄μ–ΈνΈλ” μκΈ° μμ‹ μ uidλ¥Ό `members`μ— μ¶”κ°€/μμ •ν•μ—¬ μ±„ν…λ°© μ…μ¥/ν‡΄μ¥ λ° λ©”μ‹μ§€ μ•λ¦Ό μ„¤μ •μ„ κ΄€λ¦¬ν•©λ‹λ‹¤.

### λ°μ΄ν„° κµ¬μ΅°

```
/chat-rooms/
β”β”€β”€ group-team123/
β”‚   β”β”€β”€ name: "ν€ μ±„ν…λ°©"
β”‚   β”β”€β”€ description: "Sprint 24 μ§„ν–‰ μ±„λ„"
β”‚   β”β”€β”€ open: false
β”‚   β”β”€β”€ type: "group"
β”‚   β”β”€β”€ owner: "uid_creator"              // ν΄λΌμ΄μ–ΈνΈκ°€ μ„¤μ • (λ³΄μ• κ·μΉ™μΌλ΅ κ²€μ¦)
β”‚   β”β”€β”€ createdAt: 1698473000000          // Cloud Functionsμ—μ„ μλ™ μ„¤μ •
β”‚   β”β”€β”€ updatedAt: 1698473000000
β”‚   β”β”€β”€ groupListOrder: "-1698473000000"
β”‚   β”β”€β”€ members:
β”‚   β”‚   β”β”€β”€ uid_creator: true             // Cloud Functionsμ—μ„ owner μλ™ μ¶”κ°€, ν΄λΌμ΄μ–ΈνΈλ” μκΈ° μμ‹ λ§ μ¶”κ°€/μμ • κ°€λ¥
β”‚   β”‚   β””β”€β”€ uid_teammate: true            // ν΄λΌμ΄μ–ΈνΈκ°€ μ…μ¥ μ‹ μ¶”κ°€ (true=λ©”μ‹μ§€ μ•λ¦Ό λ°›κΈ°, false=μ•λ¦Ό μ• λ°›κΈ°)
β”‚   β”β”€β”€ memberCount: 2                    // Cloud Functionsμ—μ„ members κΈ°λ°μΌλ΅ μλ™ κ³„μ‚° (λ¨λ“  uid κ°μ, true/false κµ¬λ¶„ μ—†μ΄)
β”‚   β””β”€β”€ stats:
β”‚       β””β”€β”€ messageCount: 120
β””β”€β”€ open-general/
    β”β”€β”€ name: "μ¤ν” μ»¤λ®¤λ‹ν‹°"
    β”β”€β”€ open: true
    β”β”€β”€ type: "open"
    β”β”€β”€ owner: "uid_creator"              // ν΄λΌμ΄μ–ΈνΈκ°€ μ„¤μ • (λ³΄μ• κ·μΉ™μΌλ΅ κ²€μ¦)
    β”β”€β”€ createdAt: 1698474000000          // Cloud Functionsμ—μ„ μλ™ μ„¤μ •
    β”β”€β”€ openListOrder: "-1698474000000"
    β”β”€β”€ members:
    β”‚   β”β”€β”€ uid_creator: true             // λ©”μ‹μ§€ μ•λ¦Ό λ°›μ
    β”‚   β”β”€β”€ uid_user2: true               // λ©”μ‹μ§€ μ•λ¦Ό λ°›μ
    β”‚   β””β”€β”€ uid_user3: false              // λ©”μ‹μ§€ μ•λ¦Ό μ• λ°›μ (μ±„ν…λ°©μ—λ” μ°Έμ—¬ μ¤‘)
    β”β”€β”€ memberCount: 3                    // Cloud Functionsμ—μ„ members κΈ°λ°μΌλ΅ μλ™ κ³„μ‚° (λ¨λ“  uid κ°μ, true/false κµ¬λ¶„ μ—†μ΄)
    β””β”€β”€ ...
```

### ν•„λ“ μ„¤λ…

| ν•„λ“ | νƒ€μ… | ν•„μ | μ„¤λ… |
|------|------|------|------|
| `name` | string | β… | μ±„ν…λ°© μ΄λ¦„, μµλ€ 50μ |
| `description` | string | β | μ†κ° λ¬Έκµ¬, μµλ€ 200μ |
| `type` | string | β… | μ±„ν…λ°© μ ν• (`group`, `open`, `single`) |
| `open` | boolean | β… | μ¤ν” μ±— μ—¬λ¶€ (`true`λ©΄ μ „μ²΄ κ³µκ°) |
| `owner` | string | β… | λ°© μƒμ„±μ UID. **ν΄λΌμ΄μ–ΈνΈκ°€ μ„¤μ •** (λ³΄μ• κ·μΉ™μΌλ΅ `auth.uid`μ™€ μΌμΉ κ²€μ¦) |
| `createdAt` | number | β… | μƒμ„± μ‹κ°„ (Unix timestamp ms). **Cloud Functionsμ—μ„λ§ μ„¤μ •** |
| `updatedAt` | number | β… | μμ • μ‹κ°„ (Unix timestamp ms) |
| `groupListOrder` | string/number | β | κ·Έλ£Ή μ±— μ •λ ¬μ© order. ν΄λΌμ΄μ–ΈνΈκ°€ `-Date.now()` ν•μ‹μΌλ΅ μ„¤μ • |
| `openListOrder` | string/number | β | μ¤ν” μ±— μ •λ ¬μ© order. `open: true`μΌ λ•λ§ μƒμ„± |
| `members` | object | β… | μ°Έμ—¬μ λ° μ•λ¦Ό μ„¤μ • κ°μ²΄ (`{uid: boolean}`). **Cloud Functionsμ—μ„ owner μλ™ μ¶”κ°€**, **ν΄λΌμ΄μ–ΈνΈλ” μκΈ° μμ‹ λ§ μ¶”κ°€/μμ •/μ‚­μ  κ°€λ¥**. `true`=λ©”μ‹μ§€ μ•λ¦Ό λ°›μ, `false`=μ•λ¦Ό μ• λ°›μ, `μ‚­μ λ¨`=μ±„ν…λ°©μ—μ„ μ™„μ „ν λ‚κ° |
| `memberCount` | number | β… | μ „μ²΄ μ°Έμ—¬μ μ. **Cloud Functionsμ—μ„ μλ™ κ³„μ‚°** (`members` κ°μ²΄μ λ¨λ“  uid κ°μ, true/false κµ¬λ¶„ μ—†μ΄) |
| `stats` | object | β | λ©”μ‹μ§€ μ λ“± ν™•μ¥ κ°€λ¥ν• ν†µκ³„ ν•„λ“ |

### ν΄λΌμ΄μ–ΈνΈ/μ„λ²„ μ—­ν•  λ¶„λ¦¬

#### μ±„ν…λ°© μƒμ„± μ‹

- **ν΄λΌμ΄μ–ΈνΈ**
  - `/chat-rooms/{roomId}`μ— `name`, `description`, `open`, `type`, `owner` λ“± κΈ°λ³Έ μ •λ³΄λ¥Ό μ‘μ„±
  - `owner` ν•„λ“λ¥Ό `auth.uid`λ΅ μ„¤μ • (λ³΄μ• κ·μΉ™μ΄ `auth.uid`μ™€ μΌμΉν•λ”μ§€ κ²€μ¦)
  - `createdAt`, `memberCount`, `members` ν•„λ“λ” **μ‘μ„±ν•μ§€ μ•μ** (Cloud Functionsμ—μ„λ§ μ„¤μ •)
- **Cloud Functions**
  - `onValueCreated("/chat-rooms/{roomId}")` νΈλ¦¬κ±° μ‹¤ν–‰
  - `owner` κ°’μ„ μ½μ–΄ μƒμ„±μ UID ν™•μΈ (λ³΄μ• κ·μΉ™μΌλ΅ μ΄λ―Έ κ²€μ¦λ¨)
  - `createdAt` ν•„λ“λ¥Ό ν„μ¬ νƒ€μ„μ¤νƒ¬ν”„λ΅ μ„¤μ •
  - `members` κ°μ²΄μ— `{owner: true}` μ¶”κ°€
  - `memberCount`λ¥Ό 1λ΅ μ„¤μ • (μ΄κΈ°κ°’)

#### μ±„ν…λ°© μ…μ¥/ν‡΄μ¥ μ‹

- **ν΄λΌμ΄μ–ΈνΈ**
  - μ±„ν…λ°© μ…μ¥: `/chat-rooms/{roomId}/members/{uid}`λ¥Ό `true`λ΅ μ„¤μ •
    - `joinChatRoom(db, roomId, uid)` ν•¨μ μ‚¬μ© (chat.functions.ts)
    - λ©”μ‹μ§€ μ•λ¦Όμ„ λ°›λ„λ΅ μ„¤μ •
    - λ³΄μ• κ·μΉ™: μκΈ° μμ‹ μ uidλ§ μ“°κΈ° κ°€λ¥
  - μ±„ν…λ°© ν‡΄μ¥: `/chat-rooms/{roomId}/members/{uid}`λ¥Ό `false`λ΅ μ„¤μ •
    - `leaveChatRoom(db, roomId, uid)` ν•¨μ μ‚¬μ© (chat.functions.ts)
    - λ©”μ‹μ§€ μ•λ¦Όμ„ λ°›μ§€ μ•λ„λ΅ μ„¤μ •
- **Cloud Functions**
  - `onValueWritten("/chat-rooms/{roomId}/members/{uid}")` νΈλ¦¬κ±° μ‹¤ν–‰
  - `/chat-rooms/{roomId}/members` μ•„λμ λ¨λ“  uid μ½κΈ°
  - `value === true`μΈ uidμ κ°μλ¥Ό μ„Έμ–΄ `memberCount` μ—…λ°μ΄νΈ
  - μλ™μΌλ΅ ν™μ„± μ°Έμ—¬μ μλ¥Ό λ™κΈ°ν™”

> π” **λ³΄μ• κ·μΉ™ μ—°κ³„**:
> - `/chat-rooms/{roomId}/owner`λ” λ°©μ΄ μ΅΄μ¬ν•μ§€ μ•μ„ λ•λ§ μ“°κΈ° κ°€λ¥ν•λ©°, `newData.val() === auth.uid` μ΅°κ±΄μΌλ΅ μ ν•
> - `/chat-rooms/{roomId}/createdAt`μ™€ `/chat-rooms/{roomId}/memberCount`λ” `.write: false`λ΅ ν΄λΌμ΄μ–ΈνΈ μ“°κΈ° κΈμ§€
> - `/chat-rooms/{roomId}/members/{uid}`λ” `$uid === auth.uid` μ΅°κ±΄μΌλ΅ μκΈ° μμ‹ λ§ μ“°κΈ° κ°€λ¥
> - λ”°λΌμ„ μ‚¬μ–‘μƒ owner μ„μ΅°κ°€ λ¶κ°€λ¥ν•λ©°, Cloud Functionsλ§μ΄ μ‹ λΆ°ν•  μ μλ” κ°’μ„ μ„¤μ •ν•  μ μμµλ‹λ‹¤.

> π’΅ **λ©”μ‹μ§€ μ•λ¦Ό κ΄€λ¦¬**:
> - `members` ν•„λ“λ” μ°Έμ—¬μ λ©λ΅κ³Ό λ©”μ‹μ§€ μ•λ¦Ό μμ‹  μ—¬λ¶€λ¥Ό ν•¨κ» κ΄€λ¦¬ν•©λ‹λ‹¤
> - `true`: μ‚¬μ©μκ°€ μ±„ν…λ°©μ— μ°Έμ—¬ μ¤‘μ΄λ©° λ©”μ‹μ§€ μ•λ¦Όμ„ λ°›μ
> - `false`: μ‚¬μ©μκ°€ μ±„ν…λ°©μ—μ„ λ‚κ°”κ±°λ‚ μ•λ¦Όμ„ λ°›μ§€ μ•μ
> - `memberCount`λ” ν•­μƒ `members` ν•„λ“μ—μ„ `true`μΈ uidμ κ°μμ™€ λ™μΌν•κ² μ μ§€λ©λ‹λ‹¤

---

## μ±„ν… λ©”μ‹μ§€ (chat-messages)

μ±„ν… λ©”μ‹μ§€λ” `/chat-messages/<messageId>/` κ²½λ΅μ— μ €μ¥λ©λ‹λ‹¤.
κ²μ‹κΈ€κ³Ό λ“κΈ€ κΈ°λ¥μ„ ν†µν•©ν•μ—¬ ν•λ‚μ λ©”μ‹μ§€ κµ¬μ΅°λ΅ κ΄€λ¦¬ν•©λ‹λ‹¤.

### λ°μ΄ν„° κµ¬μ΅°

```
/chat-messages/
β”β”€β”€ <messageId1>/
β”‚   β”β”€β”€ roomId: "single-uid1-uid2"
β”‚   β”β”€β”€ type: "text"
β”‚   β”β”€β”€ text: "μ•λ…•ν•μ„Έμ”!"
β”‚   β”β”€β”€ senderUid: "uid1"
β”‚   β”β”€β”€ createdAt: 1698473000000
β”‚   β””β”€β”€ protocol: null
β””β”€β”€ <messageId2>/
    β”β”€β”€ roomId: "group-roomid"
    β”β”€β”€ type: "image"
    β”β”€β”€ text: ""
    β”β”€β”€ imageUrl: "https://..."
    β”β”€β”€ senderUid: "uid2"
    β”β”€β”€ createdAt: 1698473100000
    β””β”€β”€ protocol: null
```

### ν•„λ“ μ„¤λ…

| ν•„λ“ | νƒ€μ… | ν•„μ | μ„¤λ… |
|------|------|------|------|
| `roomId` | string | β… | μ±„ν…λ°© ID (1:1, κ·Έλ£Ή, μ¤ν” μ±„ν…) |
| `type` | string | β… | λ©”μ‹μ§€ μ ν• (text, image, file λ“±) |
| `text` | string | β | λ©”μ‹μ§€ ν…μ¤νΈ λ‚΄μ© |
| `senderUid` | string | β… | λ°μ‹ μ UID |
| `createdAt` | number | β… | λ©”μ‹μ§€ μƒμ„± μ‹κ°„ (Unix timestamp, λ°€λ¦¬μ΄) |
| `protocol` | string | β | ν”„λ΅ν† μ½ λ©”μ‹μ§€ μ ν• (join, leave λ“± μ‹μ¤ν… λ©”μ‹μ§€) |
| `imageUrl` | string | β | μ΄λ―Έμ§€ λ©”μ‹μ§€μ κ²½μ° μ΄λ―Έμ§€ URL |
| `fileUrl` | string | β | νμΌ λ©”μ‹μ§€μ κ²½μ° νμΌ λ‹¤μ΄λ΅λ“ URL |

### roomId ν•μ‹

μ±„ν…λ°© μ ν•μ— λ”°λΌ roomId ν•μ‹μ΄ λ‹¤λ¦…λ‹λ‹¤:

- **1:1 μ±„ν…**: `single-{uid1}-{uid2}` (μ•νλ²³ μ μ •λ ¬)
  - μ: `single-abc123-xyz789`
  - λ‘ μ‚¬μ©μμ UIDλ¥Ό μ•νλ²³ μμΌλ΅ μ •λ ¬ν•μ—¬ κ³ μ •λ roomId μƒμ„±
- **κ·Έλ£Ή μ±„ν…**: `group-{roomId}`
  - μ: `group-team123`
- **μ¤ν” μ±„ν…**: `open-{roomId}`
  - μ: `open-general`

### ν΄λΌμ΄μ–ΈνΈ/μ„λ²„ μ—­ν•  λ¶„λ¦¬

μ±„ν… λ©”μ‹μ§€μ κ²½μ°:
- **ν΄λΌμ΄μ–ΈνΈλ”** `roomId`, `type`, `text`, `senderUid`, `createdAt` λ“± λ©”μ‹μ§€ κΈ°λ³Έ μ •λ³΄λ¥Ό μ €μ¥ν•©λ‹λ‹¤.
- **μ„λ²„λ”** λ©”μ‹μ§€ μƒμ„±μ„ κ°μ§€ν•μ—¬ λ‹¤μ μ‘μ—…μ„ μλ™μΌλ΅ μν–‰ν•©λ‹λ‹¤:
  - 1:1 μ±„ν…μ κ²½μ° μ–‘μ½ μ‚¬μ©μμ `chat-joins` μλ™ μƒμ„±/μ—…λ°μ΄νΈ (Cloud Functions)
  - κ·Έλ£Ή/μ¤ν” μ±„ν…μ κ²½μ° μ°Έμ—¬μ λ©λ΅ κΈ°λ° `chat-joins` μ—…λ°μ΄νΈ (μ¶”ν›„ κµ¬ν„)
  - μ½μ§€ μ•μ€ λ©”μ‹μ§€ μΉ΄μ΄ν„° μ—…λ°μ΄νΈ (μ¶”ν›„ κµ¬ν„)

### κ΄€λ ¨ κ°€μ΄λ“

- **π“– κµ¬ν„ κ°€μ΄λ“**: [μ±„ν… κΈ°λ¥ κ°λ° κ°€μ΄λ“](./sonub-chat-room.md) - μ±„ν…λ°© μƒμ„±, λ©”μ‹μ§€ μ „μ†΅, μ‹¤μ‹κ°„ λ©”μ‹μ§€ μμ‹ 
- **π“– Cloud Functions**: [Firebase Cloud Functions κ°λ° κ°€μ΄λ“](./sonub-firebase-functions.md) - μ±„ν… λ©”μ‹μ§€ μ²λ¦¬ λ΅μ§
- **π“– νμΌ μ—…λ΅λ“**: [νμΌ λ° μ‚¬μ§„ μ—…λ΅λ“ κ°€μ΄λ“](./sns-web-storage.md) - μ΄λ―Έμ§€/νμΌ λ©”μ‹μ§€ μ—…λ΅λ“

---

## μ±„ν… λ¶λ§ν¬ (chat-favorites)

μ±„ν…λ°© λ¶λ§ν¬(μ¦κ²¨μ°ΎκΈ°) μ •λ³΄λ” `/chat-favorites/<uid>/<favoriteId>/` κ²½λ΅μ— μ €μ¥λ©λ‹λ‹¤.
μ‚¬μ©μκ°€ μμ£Ό μ‚¬μ©ν•λ” μ±„ν…λ°©μ„ ν΄λ”λ³„λ΅ λ¶„λ¥ν•μ—¬ κ΄€λ¦¬ν•  μ μμµλ‹λ‹¤.

### λ°μ΄ν„° κµ¬μ΅°

```
/chat-favorites/
β”β”€β”€ <uid1>/
β”‚   β”β”€β”€ <favoriteId1>/
β”‚   β”‚   β”β”€β”€ name: "μ—…λ¬΄ κ΄€λ ¨"
β”‚   β”‚   β”β”€β”€ description: "ν€ μ±„ν…μ„ λ¨μ•„λ‘” ν΄λ”"
β”‚   β”‚   β”β”€β”€ createdAt: 1698473000000
β”‚   β”‚   β”β”€β”€ folderOrder: "5001698473000000"
β”‚   β”‚   β””β”€β”€ roomList:
β”‚   β”‚       β”β”€β”€ "group-team123": true
β”‚   β”‚       β””β”€β”€ "open-community": true
β”‚   β””β”€β”€ <favoriteId2>/
β”‚       β”β”€β”€ name: "μΉκµ¬λ“¤"
β”‚       β”β”€β”€ description: "μΉν• μΉκµ¬λ“¤κ³Όμ μ±„ν…"
β”‚       β”β”€β”€ createdAt: 1698473100000
β”‚       β”β”€β”€ folderOrder: "5001698473100000"
β”‚       β””β”€β”€ roomList:
β”‚           β”β”€β”€ "single-uid1-uid2": true
β”‚           β””β”€β”€ "single-uid1-uid3": true
β””β”€β”€ <uid2>/
    β””β”€β”€ <favoriteId1>/
        β”β”€β”€ name: "μ¤‘μ”"
        β”β”€β”€ description: ""
        β”β”€β”€ createdAt: 1698474000000
        β”β”€β”€ folderOrder: "5001698474000000"
        β””β”€β”€ roomList:
            β””β”€β”€ "group-project": true
```

### ν•„λ“ μ„¤λ…

| ν•„λ“ | νƒ€μ… | ν•„μ | μ„¤λ… |
|------|------|------|------|
| `name` | string | β… | λ¶λ§ν¬ ν΄λ” μ΄λ¦„ (μµλ€ 30μ) |
| `description` | string | β | ν΄λ” μ„¤λ… (μµλ€ 100μ) |
| `createdAt` | number | β… | ν΄λ” μƒμ„± μ‹κ°„ (Unix timestamp, λ°€λ¦¬μ΄) |
| `folderOrder` | string | β… | ν΄λ” μ •λ ¬ μμ„ (prefix + timestamp) |
| `roomList` | object | β… | λ¶λ§ν¬λ μ±„ν…λ°© ID λ©λ΅ (`{roomId: boolean}`) |

### folderOrder ν•„λ“

λ¶λ§ν¬ ν΄λ”μ μ •λ ¬ μμ„λ¥Ό κ΄€λ¦¬ν•λ” ν•„λ“μ…λ‹λ‹¤.

**ν•μ‹:**
```typescript
folderOrder: "500{timestamp}"
```

**νΉμ§•:**
- **500 prefix**: ν΄λ”λ¥Ό μƒλ‹¨μ— κ³ μ •ν•κΈ° μ„ν• prefix
- **timestamp**: ν΄λ” μƒμ„± μ‹κ°„ λλ” μλ™ μ •λ ¬ μ‹κ°„
- μ‚¬μ©μκ°€ ν΄λ” μμ„λ¥Ό λ³€κ²½ν•λ©΄ μƒλ΅μ΄ timestampλ΅ μ—…λ°μ΄νΈ

**μ •λ ¬ λ°©μ‹:**
```
λ‚΄λ¦Όμ°¨μ μ •λ ¬ κ²°κ³Ό (μµμ‹ μ):
"5001698474000000"  (κ°€μ¥ μµκ·Ό λλ” μƒλ‹¨ κ³ μ •)  β† μµμƒμ„
"5001698473100000"  (μ¤‘κ°„)
"5001698473000000"  (κ°€μ¥ μ¤λλ¨)              β† λ§¨ μ•„λ
```

### ν΄λΌμ΄μ–ΈνΈ/μ„λ²„ μ—­ν•  λ¶„λ¦¬

λ¶λ§ν¬ ν΄λ”μ κ²½μ°:
- **ν΄λΌμ΄μ–ΈνΈλ”** λ‹¤μ μ‘μ—…μ„ μν–‰ν•©λ‹λ‹¤:
  - λ¶λ§ν¬ ν΄λ” μƒμ„±: `/chat-favorites/{uid}/{favoriteId}` λ…Έλ“ μƒμ„±
    - `name`, `description`, `createdAt` μ €μ¥
    - `folderOrder`: `500${Date.now()}` ν•μ‹μΌλ΅ μƒμ„±
    - `roomList`: λΉ κ°μ²΄ `{}` λλ” μ΄κΈ° μ±„ν…λ°© ν¬ν•¨
  - ν΄λ” μ΄λ¦„/μ„¤λ… μμ •
  - ν΄λ” μ‚­μ 
  - μ±„ν…λ°© μ¶”κ°€/μ κ±°: `roomList/{roomId}` κ°’μ„ `true` λλ” `false`λ΅ μ„¤μ •
  - ν΄λ” μμ„ λ³€κ²½: `folderOrder`λ¥Ό μƒλ΅μ΄ `500${Date.now()}`λ΅ μ—…λ°μ΄νΈ

- **μ„λ²„λ”** λ¶λ§ν¬ κ΄€λ ¨ μλ™ μ²λ¦¬κ°€ ν•„μ” μ—†μµλ‹λ‹¤:
  - λ¨λ“  μ‘μ—…μ΄ ν΄λΌμ΄μ–ΈνΈμ—μ„ μ§μ ‘ μν–‰λ¨
  - λ‹¨, Security Rulesλ΅ λ³ΈμΈλ§ μμ • κ°€λ¥ν•λ„λ΅ μ ν•

### μ‚¬μ© μμ‹

**ν΄λ” κµ¬μ΅° μμ‹:**
```
π“ μ—…λ¬΄ κ΄€λ ¨
  β”β”€β”€ κ°λ°ν€ μ±„ν… (group-team123)
  β””β”€β”€ κΈ΄κΈ‰ κ³µμ§€ (open-community)

π“ μΉκµ¬λ“¤
  β”β”€β”€ μ² μμ™€μ λ€ν™” (single-uid1-uid2)
  β””β”€β”€ μν¬μ™€μ λ€ν™” (single-uid1-uid3)

π“ μ¤‘μ”
  β””β”€β”€ ν”„λ΅μ νΈ A (group-project)
```

### κ΄€λ ¨ κ°€μ΄λ“

- **π“– κµ¬ν„ κ°€μ΄λ“**: [μ±„ν… κΈ°λ¥ κ°λ° κ°€μ΄λ“](./sonub-chat-room.md) - λ¶λ§ν¬ κΈ°λ¥ κµ¬ν„
- **π“– λ³΄μ• κ·μΉ™**: [Firebase λ³΄μ• κ·μΉ™ κ°λ° κ°€μ΄λ“](./sns-web-security.md) - λ¶λ§ν¬ μ ‘κ·Ό μ μ–΄

---

## μ±„ν…λ°© μ°Έμ—¬ (chat-joins)

μ±„ν…λ°© μ°Έμ—¬ μ •λ³΄λ” `/chat-joins/<uid>/<roomId>/` κ²½λ΅μ— μ €μ¥λ©λ‹λ‹¤.
κ° μ‚¬μ©μκ°€ μ°Έμ—¬ν• μ±„ν…λ°© λ©λ΅μ„ κ΄€λ¦¬ν•λ©°, μ±„ν…λ°© λ©λ΅ ν™”λ©΄μ—μ„ μ‚¬μ©λ©λ‹λ‹¤.

### λ°μ΄ν„° κµ¬μ΅°

```
/chat-joins/
β”β”€β”€ <uid1>/
β”‚   β”β”€β”€ single-uid1-uid2/
β”‚   β”‚   β”β”€β”€ roomId: "single-uid1-uid2"
β”‚   β”‚   β”β”€β”€ roomType: "single"
β”‚   β”‚   β”β”€β”€ partnerUid: "uid2"
β”‚   β”‚   β”β”€β”€ lastMessageText: "μ•λ…•ν•μ„Έμ”!"
β”‚   β”‚   β”β”€β”€ lastMessageAt: 1698473000000
β”‚   β”‚   β”β”€β”€ joinedAt: 1698472000000
β”‚   β”‚   β”β”€β”€ updatedAt: 1698473000000
β”‚   β”‚   β”β”€β”€ newMessageCount: 0
β”‚   β”‚   β”β”€β”€ listOrder: "1698473000000"  // (μ‚¬μ© μ¤‘λ‹¨ μμ •, ν›„λ°© νΈν™μ„±μ©)
β”‚   β”‚   β”β”€β”€ singleChatListOrder: "1698473000000"  // μ½μ§€ μ•μ€ λ©”μ‹μ§€ μ—†μ
β”‚   β”‚   β””β”€β”€ allChatListOrder: 1698473000000  // μ „μ²΄ μ±„ν…λ°© λ©λ΅μ©
β”‚   β”β”€β”€ group-team123/
β”‚   β”‚   β”β”€β”€ roomId: "group-team123"
β”‚   β”‚   β”β”€β”€ roomType: "group"
β”‚   β”‚   β”β”€β”€ roomName: "ν€ νμλ°©"
β”‚   β”‚   β”β”€β”€ lastMessageText: "νμ μ‹μ‘ν•©λ‹λ‹¤"
β”‚   β”‚   β”β”€β”€ lastMessageAt: 1698474000000
β”‚   β”‚   β”β”€β”€ joinedAt: 1698472500000
β”‚   β”‚   β”β”€β”€ updatedAt: 1698474000000
β”‚   β”‚   β”β”€β”€ newMessageCount: 3
β”‚   β”‚   β”β”€β”€ listOrder: "2001698474000000"  // (μ‚¬μ© μ¤‘λ‹¨ μμ •, ν›„λ°© νΈν™μ„±μ©)
β”‚   β”‚   β”β”€β”€ groupChatListOrder: "2001698474000000"  // μ½μ§€ μ•μ€ λ©”μ‹μ§€ 3κ°
β”‚   β”‚   β”β”€β”€ openAndGroupChatListOrder: 1698474000000  // κ·Έλ£Ή+μ¤ν” ν†µν•© λ©λ΅μ©
β”‚   β”‚   β””β”€β”€ allChatListOrder: 1698474000000  // μ „μ²΄ μ±„ν…λ°© λ©λ΅μ©
β”‚   β””β”€β”€ open-discussion/
β”‚       β”β”€β”€ roomId: "open-discussion"
β”‚       β”β”€β”€ roomType: "open"
β”‚       β”β”€β”€ roomName: "μμ  ν† λ΅ λ°©"
β”‚       β”β”€β”€ lastMessageText: "λ„κµ¬λ‚ ν™μν•©λ‹λ‹¤"
β”‚       β”β”€β”€ lastMessageAt: 1698475000000
β”‚       β”β”€β”€ joinedAt: 1698473000000
β”‚       β”β”€β”€ updatedAt: 1698475000000
β”‚       β”β”€β”€ newMessageCount: 0
β”‚       β”β”€β”€ listOrder: "1698475000000"  // (μ‚¬μ© μ¤‘λ‹¨ μμ •, ν›„λ°© νΈν™μ„±μ©)
β”‚       β”β”€β”€ openChatListOrder: "1698475000000"  // μ½μ§€ μ•μ€ λ©”μ‹μ§€ μ—†μ
β”‚       β”β”€β”€ openAndGroupChatListOrder: 1698475000000  // κ·Έλ£Ή+μ¤ν” ν†µν•© λ©λ΅μ©
β”‚       β””β”€β”€ allChatListOrder: 1698475000000  // μ „μ²΄ μ±„ν…λ°© λ©λ΅μ©
β””β”€β”€ <uid2>/
    β””β”€β”€ single-uid1-uid2/
        β”β”€β”€ roomId: "single-uid1-uid2"
        β”β”€β”€ roomType: "single"
        β”β”€β”€ partnerUid: "uid1"
        β”β”€β”€ lastMessageText: "μ•λ…•ν•μ„Έμ”!"
        β”β”€β”€ lastMessageAt: 1698473000000
        β”β”€β”€ joinedAt: 1698472000000
        β”β”€β”€ updatedAt: 1698473000000
        β”β”€β”€ newMessageCount: 1
        β”β”€β”€ listOrder: "2001698473000000"  // (μ‚¬μ© μ¤‘λ‹¨ μμ •, ν›„λ°© νΈν™μ„±μ©)
        β”β”€β”€ singleChatListOrder: "2001698473000000"  // μ½μ§€ μ•μ€ λ©”μ‹μ§€ 1κ°
        β””β”€β”€ allChatListOrder: 1698473000000  // μ „μ²΄ μ±„ν…λ°© λ©λ΅μ©
```

### ν•„λ“ μ„¤λ…

| ν•„λ“ | νƒ€μ… | ν•„μ | μ„¤λ… |
|------|------|------|------|
| `roomId` | string | β… | μ±„ν…λ°© ID |
| `roomType` | string | β… | μ±„ν…λ°© μ ν• (single, group, open) |
| `roomName` | string | β | μ±„ν…λ°© μ΄λ¦„ (κ·Έλ£Ή/μ¤ν” μ±„ν…λ°©μ κ²½μ°) |
| `partnerUid` | string | β | 1:1 μ±„ν…μ μƒλ€λ°© UID (1:1 μ±„ν…λ§ ν•΄λ‹Ή) |
| `lastMessageText` | string | β | λ§μ§€λ§‰ λ©”μ‹μ§€ λ‚΄μ© (λ―Έλ¦¬λ³΄κΈ°μ©) |
| `lastMessageAt` | number | β… | λ§μ§€λ§‰ λ©”μ‹μ§€ μ‹κ°„ (Unix timestamp, λ°€λ¦¬μ΄) |
| `joinedAt` | number | β… | μ±„ν…λ°© μ°Έμ—¬ μ‹κ°„ (Unix timestamp, λ°€λ¦¬μ΄) |
| `updatedAt` | number | β… | λ§μ§€λ§‰ μ—…λ°μ΄νΈ μ‹κ°„ (Unix timestamp, λ°€λ¦¬μ΄) |
| `newMessageCount` | number | β… | μ½μ§€ μ•μ€ λ©”μ‹μ§€ κ°μ (Cloud Functionsκ°€ μλ™ μ¦κ°) |
| `pin` | boolean | β | **μ±„ν…λ°© ν•€ μƒνƒ** (true: ν•€λ¨, μƒλµ: ν•€ μ•λ¨). ν΄λΌμ΄μ–ΈνΈκ°€ μ„¤μ •ν•λ©΄ Cloud Functionsκ°€ μλ™μΌλ΅ λ¨λ“  order ν•„λ“μ— "500" prefix μ μ© |
| `listOrder` | string | β | **μ •λ ¬ ν•„λ“** (ν›„λ°© νΈν™μ„±μ©, μ‚¬μ© μ¤‘λ‹¨ μμ •) |
| `singleChatListOrder` | string | β | **1:1 μ±„ν… μ •λ ¬ ν•„λ“** (prefix + timestamp) |
| `groupChatListOrder` | string/number | β | **κ·Έλ£Ή μ±„ν… μ •λ ¬ ν•„λ“** (prefix + timestamp) |
| `openChatListOrder` | string/number | β | **μ¤ν” μ±„ν… μ •λ ¬ ν•„λ“** (prefix + timestamp) |
| `openAndGroupChatListOrder` | number | β | **κ·Έλ£Ή+μ¤ν” ν†µν•© μ •λ ¬ ν•„λ“** (prefix + timestamp) |
| `allChatListOrder` | number | β | **μ „μ²΄ μ±„ν…λ°© ν†µν•© μ •λ ¬ ν•„λ“** (timestamp, λ¨λ“  νƒ€μ…) |

### π”¥ μ •λ ¬ ν•„λ“ μƒμ„Έ μ„¤λ…

μ±„ν…λ°© λ©λ΅μ„ λ‹¤μ–‘ν• λ°©μ‹μΌλ΅ μ •λ ¬ν•κΈ° μ„ν•΄ μ—¬λ¬ μ •λ ¬ ν•„λ“κ°€ μ κ³µλ©λ‹λ‹¤.

#### μ •λ ¬ ν•„λ“ κ°μ”

| ν•„λ“ | μ©λ„ | νƒ€μ… | Cloud Functions μ„¤μ • |
|------|------|------|---------------------|
| `singleChatListOrder` | 1:1 μ±„ν…λ§ μ •λ ¬ | string (prefix + timestamp) | β… μλ™ |
| `groupChatListOrder` | κ·Έλ£Ή μ±„ν…λ§ μ •λ ¬ | string (prefix + timestamp) | β… μλ™ |
| `openChatListOrder` | μ¤ν” μ±„ν…λ§ μ •λ ¬ | string (prefix + timestamp) | β… μλ™ |
| `openAndGroupChatListOrder` | κ·Έλ£Ή+μ¤ν” ν†µν•© μ •λ ¬ | number (timestamp) | β… μλ™ |
| `allChatListOrder` | λ¨λ“  μ±„ν…λ°© ν†µν•© μ •λ ¬ | number (timestamp) | β… μλ™ |
| `listOrder` | (ν›„λ°© νΈν™μ„±μ©) | string | β οΈ μ‚¬μ© μ¤‘λ‹¨ |

#### μ™ μ •λ ¬ ν•„λ“κ°€ ν•„μ”ν•κ°€?

Firebase Realtime Databaseμ—μ„ μ±„ν…λ°© λ©λ΅μ„ μ •λ ¬ν•  λ• λ‹¤μ μ”κµ¬μ‚¬ν•­μ„ λ§μ΅±ν•΄μ•Ό ν•©λ‹λ‹¤:

1. β **λ‹¨μ timestamp μ •λ ¬**: `orderByChild('lastMessageAt')` μ‚¬μ© μ‹
   - λ¬Έμ μ : ν΄λΌμ΄μ–ΈνΈμ—μ„ reverse() ν•„μ” (μ„±λ¥ μ €ν•)
   - λ¬Έμ μ : μ½μ§€ μ•μ€ λ©”μ‹μ§€κ°€ μλ” μ±„ν…λ°©μ„ λ§¨ μ„μ— ν‘μ‹ν•  μ μ—†μ
   - λ¬Έμ μ : PIN(κ³ μ •) κΈ°λ¥ κµ¬ν„ λ¶κ°€

2. β… **prefix + timestamp μ‚¬μ©**: νƒ€μ…λ³„ μ •λ ¬ ν•„λ“ μ‚¬μ©
   - μ¥μ : Firebase μΏΌλ¦¬λ§μΌλ΅ λ‚΄λ¦Όμ°¨μ μ •λ ¬ κ°€λ¥
   - μ¥μ : μ½μ§€ μ•μ€ λ©”μ‹μ§€κ°€ μλ” μ±„ν…λ°©μ„ λ§¨ μ„μ— μλ™ λ°°μΉ
   - μ¥μ : PIN κΈ°λ¥μ„ prefixλ΅ μ‰½κ² κµ¬ν„ κ°€λ¥
   - μ¥μ : μ„λ²„μ—μ„ μλ™μΌλ΅ κ΄€λ¦¬λμ–΄ λ°μ΄ν„° μΌκ΄€μ„± λ³΄μ¥

#### μ •λ ¬ ν•„λ“ κ³„μ‚° λ°©μ‹ (Cloud Functions)

```typescript
// Cloud Functionsμ—μ„ μλ™μΌλ΅ κ³„μ‚°
const timestamp = messageData.createdAt || Date.now();

// === 1:1 μ±„ν… ===
// λ°μ‹ μ: μ½μ μƒνƒ (prefix μ—†μ)
const senderSingleListOrder = `${timestamp}`;  // "1698473000000"
// μμ‹ μ: μ½μ§€ μ•μ€ μƒνƒ (200 prefix)
const partnerSingleListOrder = `200${timestamp}`;  // "2001698473000000"

// === κ·Έλ£Ή μ±„ν… ===
// λ°μ‹ μ: μ½μ μƒνƒ
const senderGroupListOrder = `${timestamp}`;
// μμ‹ μλ“¤: μ½μ§€ μ•μ€ μƒνƒ (200 prefix)
const memberGroupListOrder = `200${timestamp}`;

// === μ¤ν” μ±„ν… ===
// λ°μ‹ μ: μ½μ μƒνƒ
const senderOpenListOrder = `${timestamp}`;
// μμ‹ μλ“¤: μ½μ§€ μ•μ€ μƒνƒ (200 prefix)
const memberOpenListOrder = `200${timestamp}`;

// === ν†µν•© μ •λ ¬ ν•„λ“ ===
// λ¨λ“  μ‚¬μ©μμ—κ² λ™μΌν• timestamp (μ½μ/μ½μ§€μ•μ κµ¬λ¶„ μ—†μ)
const allChatListOrder = timestamp;  // 1698473000000
const openAndGroupChatListOrder = timestamp;  // κ·Έλ£Ή+μ¤ν”λ§
```

#### prefix κ·μΉ™

| Prefix | μƒνƒ | μ„¤λ… | μμ‹ κ°’ |
|--------|------|------|---------|
| μ—†μ | μ½μ μƒνƒ | λ©”μ‹μ§€λ¥Ό μ½μ€ μ±„ν…λ°© (μΌλ° μ •λ ¬) | `1698473000000` |
| `200` | μ½μ§€ μ•μ | μ½μ§€ μ•μ€ λ©”μ‹μ§€κ°€ μλ” μ±„ν…λ°© (λ§¨ μ„ μ •λ ¬) | `2001698473000000` |
| `500` | PIN κ³ μ • | μ‚¬μ©μκ°€ κ³ μ •ν• μ±„ν…λ°© (μµμƒμ„ μ •λ ¬) | `5001698473000000` |

#### μ •λ ¬ μ›λ¦¬

Firebaseλ” λ¬Έμμ—΄μ„ **μ‚¬μ „μ(lexicographical order)**μΌλ΅ μ •λ ¬ν•κ³ , `reverse()`λ΅ λ‚΄λ¦Όμ°¨μ μ •λ ¬ν•©λ‹λ‹¤:

```
λ‚΄λ¦Όμ°¨μ μ •λ ¬ κ²°κ³Ό (μµμ‹ μ):
"5001698474000000"  (PIN κ³ μ • μ±„ν…λ°©)          β† μµμƒμ„
"2001698473000000"  (μ½μ§€ μ•μ€ λ©”μ‹μ§€ μμ)    β† λ§¨ μ„
"2001698472000000"  (μ½μ§€ μ•μ€ λ©”μ‹μ§€ μμ)
"1698471000000"     (μ½μ μƒνƒ, μµμ‹  λ©”μ‹μ§€)
"1698470000000"     (μ½μ μƒνƒ, μ¤λλ λ©”μ‹μ§€)  β† λ§¨ μ•„λ
```

- **500 prefix**: PIN κ³ μ • μ±„ν…λ°©μ€ ν•­μƒ μµμƒμ„
- **200 prefix**: μ½μ§€ μ•μ€ λ©”μ‹μ§€κ°€ μλ” μ±„ν…λ°©μ€ μ½μ μ±„ν…λ°©λ³΄λ‹¤ μ„
- **prefix μ—†μ**: μ½μ μƒνƒ μ±„ν…λ°©μ€ μΌλ° timestamp μ •λ ¬

#### μ½μ μ²λ¦¬ (μ •λ ¬ ν•„λ“ μ—…λ°μ΄νΈ)

μ‚¬μ©μκ°€ μ±„ν…λ°©μ— μ…μ¥ν•λ©΄ ν΄λΌμ΄μ–ΈνΈμ—μ„ 200 prefixλ¥Ό μ κ±°ν•©λ‹λ‹¤:

```typescript
// μ‚¬μ©μκ°€ μ±„ν…λ°© μ…μ¥ μ‹
const currentListOrder = "2001698473000000";  // μ½μ§€ μ•μ€ μƒνƒ

// 200 prefix μ κ±° (μ½μ μ²λ¦¬)
if (currentListOrder.startsWith("200")) {
  const newListOrder = currentListOrder.substring(3);  // "1698473000000"

  // μ±„ν…λ°© νƒ€μ…μ— λ”°λΌ μ μ ν• ν•„λ“ μ—…λ°μ΄νΈ
  if (roomType === 'single') {
    await database.ref(`chat-joins/${uid}/${roomId}/singleChatListOrder`).set(newListOrder);
  } else if (roomType === 'group') {
    await database.ref(`chat-joins/${uid}/${roomId}/groupChatListOrder`).set(newListOrder);
  } else if (roomType === 'open') {
    await database.ref(`chat-joins/${uid}/${roomId}/openChatListOrder`).set(newListOrder);
  }

  // μ½μ§€ μ•μ€ λ©”μ‹μ§€ μΉ΄μ΄ν„°λ„ 0μΌλ΅ μ΄κΈ°ν™”
  await database.ref(`chat-joins/${uid}/${roomId}/newMessageCount`).set(0);
}
```

#### ν•€ μ²λ¦¬ (μ±„ν…λ°© κ³ μ • κΈ°λ¥)

μ‚¬μ©μκ°€ μ±„ν…λ°©μ„ ν•€ν•κ±°λ‚ ν•€ ν•΄μ ν•λ” κΈ°λ¥μ…λ‹λ‹¤. ν•€λ μ±„ν…λ°©μ€ λ©λ΅μ μµμƒμ„μ— ν‘μ‹λ©λ‹λ‹¤.

**ν΄λΌμ΄μ–ΈνΈ λ™μ‘:**
```typescript
// ν•€ μ„¤μ •: pin ν•„λ“λ¥Ό trueλ΅ μ„¤μ •
await database.ref(`chat-joins/${uid}/${roomId}/pin`).set(true);

// ν•€ ν•΄μ : pin ν•„λ“λ¥Ό μ‚­μ 
await database.ref(`chat-joins/${uid}/${roomId}/pin`).set(null);
```

**Cloud Functions μλ™ μ²λ¦¬:**

`chat-joins/{uid}/{roomId}/pin` ν•„λ“κ°€ μƒμ„±λκ±°λ‚ μ‚­μ λλ©΄ Cloud Functionsκ°€ μλ™μΌλ΅ λ¨λ“  order ν•„λ“λ¥Ό μ—…λ°μ΄νΈν•©λ‹λ‹¤:

```typescript
// onChatRoomPinCreate Cloud Function (onValueCreated νΈλ¦¬κ±°)
// pin ν•„λ“κ°€ μƒμ„±λ  λ• (set(true)):
//    - λ¨λ“  xxxListOrder ν•„λ“μ— "500" prefix μ¶”κ°€
//    μ: "1698473000000" β†’ "5001698473000000"
//    μ: "2001698473000000" β†’ "5001698473000000"

// onChatRoomPinDelete Cloud Function (onValueDeleted νΈλ¦¬κ±°)
// pin ν•„λ“κ°€ μ‚­μ λ  λ• (set(null)):
//    - newMessageCount > 0μ΄λ©΄ "200" prefix μ¶”κ°€
//    μ: "5001698473000000" β†’ "2001698473000000"
//    - newMessageCount === 0μ΄λ©΄ prefix μ κ±°
//    μ: "5001698473000000" β†’ "1698473000000"
```

**νΈλ¦¬κ±° λ¶„λ¦¬ μ΄μ :**
- `onValueUpdated`λ” κ°’μ΄ λ³€κ²½λ  λ•λ§ νΈλ¦¬κ±°λλ©°, μƒμ„±/μ‚­μ  μ‹μ—λ” νΈλ¦¬κ±°λμ§€ μ•μ
- `onValueCreated`λ” ν•„λ“κ°€ μ²μ μƒμ„±λ  λ• νΈλ¦¬κ±°λ¨ (pin: true μ„¤μ • μ‹)
- `onValueDeleted`λ” ν•„λ“κ°€ μ‚­μ λ  λ• νΈλ¦¬κ±°λ¨ (pin: null μ„¤μ • μ‹)

**μλ™ μ—…λ°μ΄νΈλλ” ν•„λ“:**
- `singleChatListOrder` (1:1 μ±„ν…)
- `groupChatListOrder` (κ·Έλ£Ή μ±„ν…)
- `openChatListOrder` (μ¤ν” μ±„ν…)
- `openAndGroupChatListOrder` (κ·Έλ£Ή+μ¤ν” ν†µν•©)
- `allChatListOrder` (μ „μ²΄ μ±„ν…λ°© ν†µν•©)

**μ¥μ :**
- ν΄λΌμ΄μ–ΈνΈλ” λ‹¨μν `pin` ν•„λ“λ§ μ„¤μ •
- Cloud Functionsκ°€ λ¨λ“  μ •λ ¬ ν•„λ“λ¥Ό μΌκ΄€λκ² μ—…λ°μ΄νΈ
- μ±„ν…λ°© νƒ€μ…μ— κ΄€κ³„μ—†μ΄ λ™μΌν• λ°©μ‹μΌλ΅ λ™μ‘
- ν•€ μƒνƒμ™€ μ½μ/μ½μ§€μ•μ μƒνƒλ¥Ό λ…λ¦½μ μΌλ΅ κ΄€λ¦¬

#### ν΄λΌμ΄μ–ΈνΈμ—μ„ μ‚¬μ© μμ‹

```typescript
// μμ‹ 1: 1:1 μ±„ν…λ§ μ΅°ν
const query = database.ref(`chat-joins/${uid}`)
  .orderByChild('singleChatListOrder')
  .limitToLast(20);

// μμ‹ 2: κ·Έλ£Ή μ±„ν…λ§ μ΅°ν
const query = database.ref(`chat-joins/${uid}`)
  .orderByChild('groupChatListOrder')
  .limitToLast(20);

// μμ‹ 3: κ·Έλ£Ή+μ¤ν” μ±„ν… ν†µν•© μ΅°ν
const query = database.ref(`chat-joins/${uid}`)
  .orderByChild('openAndGroupChatListOrder')
  .limitToLast(20);

// μμ‹ 4: λ¨λ“  μ±„ν…λ°© ν†µν•© μ΅°ν
const query = database.ref(`chat-joins/${uid}`)
  .orderByChild('allChatListOrder')
  .limitToLast(20);

// κ²°κ³Ό μ²λ¦¬ (κ³µν†µ)
query.on('value', (snapshot) => {
  const chatRooms = [];
  snapshot.forEach((child) => {
    chatRooms.push(child.val());
  });
  chatRooms.reverse(); // μµμ‹ μ μ •λ ¬
  console.log(chatRooms);
});
```

#### μ£Όμμ‚¬ν•­

- β οΈ **λ°μ‹ μμ μ •λ ¬ ν•„λ“**: prefix μ—†μ΄ timestampλ§ μ €μ¥ (μ½μ μƒνƒ)
- β οΈ **μμ‹ μμ μ •λ ¬ ν•„λ“**: 200 prefix + timestamp μ €μ¥ (μ½μ§€ μ•μ€ μƒνƒ)
- β… **Cloud Functionsκ°€ λ©”μ‹μ§€ μƒμ„± μ‹ μλ™μΌλ΅ λ¨λ“  μ •λ ¬ ν•„λ“λ¥Ό μ—…λ°μ΄νΈ**ν•©λ‹λ‹¤
- β… **ν΄λΌμ΄μ–ΈνΈλ” μ½μ μ²λ¦¬/PIN κΈ°λ¥λ§ μ§μ ‘ μμ •**ν•©λ‹λ‹¤
- β οΈ νƒ€μ…λ³„ μ •λ ¬ ν•„λ“(single/group/open)λ” λ¬Έμμ—΄ νƒ€μ…μ΄μ§€λ§ μ‚¬μ „μμΌλ΅ μ •λ ¬λ©λ‹λ‹¤
- β οΈ ν†µν•© μ •λ ¬ ν•„λ“(all/openAndGroup)λ” μ«μ νƒ€μ…μ…λ‹λ‹¤
- β οΈ `newMessageCount`μ™€ ν•¨κ» μ‚¬μ©ν•μ—¬ μ½μ§€ μ•μ€ λ©”μ‹μ§€ κ°μλ¥Ό ν‘μ‹ν•©λ‹λ‹¤

### ν΄λΌμ΄μ–ΈνΈ/μ„λ²„ μ—­ν•  λ¶„λ¦¬

μ±„ν…λ°© μ°Έμ—¬ μ •λ³΄μ κ²½μ°:
- **ν΄λΌμ΄μ–ΈνΈλ”** λ‹¤μ μ‘μ—…μ„ μν–‰ν•©λ‹λ‹¤:
  - **μ±„ν…λ°© μ…μ¥ μ‹** `chat-joins/{uid}/{roomId}` λ…Έλ“ μƒμ„± (λ¨λ“  μ±„ν…λ°© νƒ€μ…: 1:1, κ·Έλ£Ή, μ¤ν”)
  - μ±„ν…λ°© μ…μ¥ μ‹ κ° μ •λ ¬ ν•„λ“μ 200 prefix μ κ±° (μ½μ μ²λ¦¬)
    - μ: `singleChatListOrder`μ "200{timestamp}"λ¥Ό "{timestamp}"λ΅ λ³€κ²½
  - μ±„ν…λ°© μ…μ¥ μ‹ `newMessageCount`λ¥Ό 0μΌλ΅ μ΄κΈ°ν™”
  - μ±„ν…λ°© PIN κ³ μ •/ν•΄μ  μ‹ κ° μ •λ ¬ ν•„λ“μ 500 prefix μ¶”κ°€/μ κ±°
    - μ: `singleChatListOrder`μ "{timestamp}"λ¥Ό "500{timestamp}"λ΅ λ³€κ²½

- **μ„λ²„λ”** μ±„ν… λ©”μ‹μ§€ μƒμ„±μ„ κ°μ§€ν•μ—¬ λ‹¤μ μ‘μ—…μ„ μλ™μΌλ΅ μν–‰ν•©λ‹λ‹¤ (Cloud Functions):

  **1:1 μ±„ν…μ κ²½μ°:**
  - μ–‘μ½ μ‚¬μ©μμ `chat-joins/{uid}/{roomId}` μλ™ μƒμ„±/μ—…λ°μ΄νΈ
  - `lastMessageText`, `lastMessageAt` μλ™ μ—…λ°μ΄νΈ
  - **μ •λ ¬ ν•„λ“ μλ™ κ³„μ‚° λ° μ—…λ°μ΄νΈ**:
    - λ°μ‹ μ:
      - `singleChatListOrder`: `${timestamp}` (prefix μ—†μ, μ½μ μƒνƒ)
      - `allChatListOrder`: `timestamp` (μ«μ νƒ€μ…)
    - μμ‹ μ:
      - `singleChatListOrder`: `200${timestamp}` (200 prefix, μ½μ§€ μ•μ€ μƒνƒ)
      - `allChatListOrder`: `timestamp` (μ«μ νƒ€μ…)
  - **`newMessageCount` μλ™ μ¦κ°€**: μμ‹ μλ§ increment(1)
  - `joinedAt`λ” μµμ΄ μƒμ„± μ‹μ—λ§ μ„¤μ • (κΈ°μ΅΄ κ°’μ΄ μμΌλ©΄ μ μ§€)
  - `partnerUid` μ„¤μ • (1:1 μ±„ν… μƒλ€λ°© UID)

  **κ·Έλ£Ή/μ¤ν” μ±„ν…μ κ²½μ°:**
  - `chat-rooms/{roomId}`μ—μ„ `members` λ©λ΅ μ΅°ν
  - λ¨λ“  λ©¤λ²„μ `chat-joins/{memberUid}/{roomId}` μλ™ μ—…λ°μ΄νΈ
  - κ° λ©¤λ²„μ— λ€ν•΄ λ‹¤μ ν•„λ“ μλ™ μ„¤μ •:
    - `roomName`: μ±„ν…λ°© μ΄λ¦„ (chat-roomsμ—μ„ κ°€μ Έμ΄)
    - `lastMessageText`: λ§μ§€λ§‰ λ©”μ‹μ§€ λ‚΄μ©
    - `lastMessageAt`: λ§μ§€λ§‰ λ©”μ‹μ§€ μ‹κ°„
    - `allChatListOrder`: timestamp (μ«μ νƒ€μ…)
    - `openAndGroupChatListOrder`: timestamp (μ«μ νƒ€μ…)
    - **νƒ€μ…λ³„ μ •λ ¬ ν•„λ“**:
      - κ·Έλ£Ή μ±„ν…μΈ κ²½μ°:
        - λ°μ‹ μ: `groupChatListOrder`: `${timestamp}`
        - λ‹¤λ¥Έ λ©¤λ²„λ“¤: `groupChatListOrder`: `200${timestamp}`
      - μ¤ν” μ±„ν…μΈ κ²½μ°:
        - λ°μ‹ μ: `openChatListOrder`: `${timestamp}`
        - λ‹¤λ¥Έ λ©¤λ²„λ“¤: `openChatListOrder`: `200${timestamp}`
  - **`newMessageCount` μλ™ μ¦κ°€**: λ°μ‹ μλ¥Ό μ μ™Έν• λ¨λ“  λ©¤λ²„μ— λ€ν•΄ increment(1)
  - `joinedAt`λ” μµμ΄ μƒμ„± μ‹μ—λ§ μ„¤μ • (κΈ°μ΅΄ κ°’μ΄ μμΌλ©΄ μ μ§€)

### κ΄€λ ¨ κ°€μ΄λ“

- **π“– κµ¬ν„ κ°€μ΄λ“**: [μ±„ν… κΈ°λ¥ κ°λ° κ°€μ΄λ“](./sonub-chat-room.md) - μ±„ν…λ°© λ©λ΅ μ΅°ν, μ •λ ¬, ν•„ν„°λ§
- **π“– Cloud Functions**: [Firebase Cloud Functions κ°λ° κ°€μ΄λ“](./sonub-firebase-functions.md) - chat-joins μλ™ μƒμ„± λ΅μ§
- **π“– λ³΄μ• κ·μΉ™**: [Firebase λ³΄μ• κ·μΉ™ κ°λ° κ°€μ΄λ“](./sns-web-security.md) - μ±„ν…λ°© μ°Έμ—¬ μ •λ³΄ μ ‘κ·Ό μ μ–΄

---

## μ£Όμ” μ„¤κ³„ μ›μΉ™

### 1. Flat Style κµ¬μ΅°

- λ°μ΄ν„°λ¥Ό λ‹¨μν•κ³  ν‰νƒ„ν• κµ¬μ΅°λ΅ μ €μ¥
- λ³µμ΅ν• λ‹¤λ‹¨κ³„ λ…Έλ“ κµ¬μ΅° νν”Ό
- μΏΌλ¦¬ ν¨μ¨μ„±κ³Ό μ„±λ¥ κ·Ήλ€ν™”

### 2. μ†μ„± λ¶„λ¦¬

- νΉμ • μ†μ„±μ— λ€ν• λ€λ‰ μ΅°νκ°€ ν•„μ”ν• κ²½μ° λ³„λ„ κ²½λ΅μ—μ„ κ΄€λ¦¬
- μ: `user-props/displayName`
- λ„¤νΈμ›ν¬ μµμ ν™” λ° μΏΌλ¦¬ μ„±λ¥ ν–¥μƒ

### 3. Cloud Functions ν™μ©

ν΄λΌμ΄μ–ΈνΈμ™€ λ°±μ—”λ“μ μ—­ν• μ„ λ…ν™•ν λ¶„λ¦¬ν•μ—¬ λ°μ΄ν„° λ¬΄κ²°μ„±κ³Ό μ„±λ¥μ„ λ³΄μ¥ν•©λ‹λ‹¤.

**μ›μΉ™:**
- β… **ν΄λΌμ΄μ–ΈνΈλ” μµμ†ν•μ λ°μ΄ν„°λ§ RTDBμ— κΈ°λ΅**
  - μ‚¬μ©μκ°€ μ§μ ‘ μ…λ ¥ν• λ°μ΄ν„° (κ²μ‹κΈ€, λ“κΈ€ λ‚΄μ© λ“±)
  - κΈ°λ³Έ λ©”νƒ€λ°μ΄ν„° (uid, createdAt, category)
- β… **λ°±μ—”λ“(Cloud Functions)λ” μ¶”κ°€ λ°μ΄ν„° μλ™ μ²λ¦¬**
  - μΉ΄μ΄ν„° μλ™ μ¦κ°€/κ°μ† (likeCount, commentCount, postCount)
  - μ „μ²΄ ν†µκ³„ μλ™ μ§‘κ³„ (stats/counters)
  - μ‚¬μ©μ μ†μ„± λ¶„λ¦¬ μλ™ λ™κΈ°ν™” (user-props)
  - λ°μ΄ν„° λ¬΄κ²°μ„± λ³΄μ¥

**ν΄λΌμ΄μ–ΈνΈμ—μ„ ν•μ§€ λ§μ•„μ•Ό ν•  μ‘μ—…:**
- β μΉ΄μ΄ν„° μ§μ ‘ μ¦κ°€/κ°μ† (`increment()` μ‚¬μ© κΈμ§€)
- β λ°μ΄ν„° μ§‘κ³„ λ° ν†µκ³„ μ§μ ‘ κ³„μ‚°
- β μ†μ„± λ¶„λ¦¬ μ‘μ—… μ§μ ‘ μν–‰
- β λ³µμ΅ν• λΉ„μ¦λ‹μ¤ λ΅μ§ μ²λ¦¬

**κµ¬μ²΄μ μΈ μμ‹μ™€ κµ¬ν„ λ°©λ²•μ€ κ° κΈ°λ¥λ³„ κ°λ° κ°€μ΄λ“ λ¬Έμ„λ¥Ό μ°Έκ³ ν•μ„Έμ”:**
- [Firebase Cloud Functions κ°λ° κ°€μ΄λ“](./sns-firebase-cloud-functions.md) - λ°±μ—”λ“ λ΅μ§ κµ¬ν„ μƒμ„Έ κ°€μ΄λ“

### 4. λ³΄μ• κ·μΉ™

- Firebase Security Rulesλ΅ μ ‘κ·Ό κ¶ν• μ μ–΄
- κ° λ°μ΄ν„° μ„Ήμ…λ³„λ΅ μ½κΈ°/μ“°κΈ° κ¶ν• μ •μ
- λ°μ΄ν„° κ²€μ¦ κ·μΉ™ ν¬ν•¨

---

## μ£Όμμ‚¬ν•­

### Firebase Auth vs RTDB ν•„λ“λ… μ°¨μ΄

**ν”„λ΅ν•„ μ‚¬μ§„ ν•„λ“λ…μ΄ λ‹¤λ¦…λ‹λ‹¤:**
- **Firebase Auth**: `photoURL` (λ€λ¬Έμ URL)
- **RTDB**: `photoUrl` (camelCase url)

μμ„Έν• λ‚΄μ©κ³Ό κµ¬ν„ μμ λ” [μ‚¬μ©μ κ΄€λ¦¬ κ°λ° κ°€μ΄λ“](./sns-web-user.md) λ° [μ½”λ”© κ°€μ΄λ“λΌμΈ - Firebase Auth vs RTDB ν•„λ“λ… μ°¨μ΄](../CLAUDE.md#firebase-auth-vs-rtdb-ν•„λ“λ…-μ°¨μ΄-λ§¤μ°-μ¤‘μ”)λ¥Ό μ°Έκ³ ν•μ„Έμ”.

---

## κ΄€λ ¨ κ°€μ΄λ“ λ¬Έμ„

μ „μ²΄ λ°μ΄ν„°λ² μ΄μ¤ κµ¬μ΅°μ™€ κ΄€λ ¨λ μƒμ„Έν• κ°λ° κ°€μ΄λ“:

- **[μ‚¬μ©μ κ΄€λ¦¬](./sns-web-user.md)** - μ‚¬μ©μ ν”„λ΅ν•„, μ†μ„± λ¶„λ¦¬, Cloud Functions
- **[μΉκµ¬ κ΄€κ³„](./sns-web-friends.md)** - μΉκµ¬, ν”λ΅μ°, ν”λ΅μ› κ΄€λ¦¬
- **[Firebase λ³΄μ•](./sns-web-security.md)** - λ³΄μ• κ·μΉ™ μ„¤μ •

---

## μ°Έκ³  μλ£

- [Firebase Realtime Database κ³µμ‹ λ¬Έμ„](https://firebase.google.com/docs/database)
- [Firebase Security Rules κ³µμ‹ λ¬Έμ„](https://firebase.google.com/docs/rules)
- [Firebase Cloud Functions κ³µμ‹ λ¬Έμ„](https://firebase.google.com/docs/functions)

---

## μ‘μ—… μ΄λ ¥ (SED Log)

| λ‚ μ§ | μ‘μ—…μ | λ‚΄μ© |
| ---- | ------ | ---- |
| 2025-11-12 | Codex Agent | `/chat-rooms` μ„Ήμ…μ„ μ‹ μ„¤ν•κ³  Cloud Functions + Security Rulesκ°€ owner/createdByλ¥Ό μλ™ μ„¤μ •Β·κ²€μ¦ν•λ” κ³Όμ •μ„ μƒμ„Έν™”ν•μ—¬ μ±„ν…λ°© λ°μ΄ν„° νλ¦„μ„ λ…μ‹. |
| 2025-11-12 | Claude Code | `roomTitle` ν•„λ“λ¥Ό μ‚¬μ–‘μ— λ§κ² `roomName`μΌλ΅ ν†µμΌ. ν΄λΌμ΄μ–ΈνΈ(ChatCreateDialog.svelte)μ™€ Firebase Functions νƒ€μ… μ •μ(types/index.ts)μ—μ„ `roomTitle`μ„ `roomName`μΌλ΅ λ³€κ²½. ν›„λ°© νΈν™μ„±μ„ μ„ν•΄ μ½κΈ° ν•¨μ(resolveRoomTitle)λ” `roomTitle`κ³Ό `roomName` λ‘ λ‹¤ μ²΄ν¬ν•λ„λ΅ μ μ§€. |
| 2025-11-12 | Claude Code | `listOrder` ν•„λ“λ¥Ό λ¨λ“  μ†μ¤ μ½”λ“μ™€ μ¤ν™ λ¬Έμ„μ—μ„ μ™„μ „ν μ κ±°. μ±„ν…λ°© νƒ€μ…λ³„ μ „μ© μ •λ ¬ ν•„λ“ μ‚¬μ©μΌλ΅ λ³€κ²½: 1) types/index.tsμ—μ„ `listOrder` ν•„λ“ μ‚­μ  2) chat.handler.tsμ λ©¤λ²„ μ…μ¥ λ΅μ§μ—μ„ νƒ€μ…λ³„ μ •λ ¬ ν•„λ“ μλ™ μ„¤μ • (groupChatListOrder, openChatListOrder, openAndGroupChatListOrder, allChatListOrder) 3) chat/list/+page.svelteμ—μ„ `allChatListOrder` μ‚¬μ© (λ¨λ“  μ±„ν… ν†µν•© λ©λ΅) 4) group-chat-list/+page.svelteμ—μ„ `openAndGroupChatListOrder` μ‚¬μ© (κ·Έλ£Ή+μ¤ν” ν†µν•© λ©λ΅) 5) database.rules.json μΈλ±μ¤ μ—…λ°μ΄νΈ 6) Firebase Functions λ°°ν¬ μ™„λ£. |
| 2025-11-12 | Claude Code | `handleChatJoinCreate` ν•¨μ λ³΄μ™„ν•μ—¬ ν΄λΌμ΄μ–ΈνΈκ°€ `chat-joins/{uid}/{roomId}` λ…Έλ“λ¥Ό μ§μ ‘ μƒμ„±ν•  λ• νƒ€μ…λ³„ μ •λ ¬ ν•„λ“κ°€ μλ™ μƒμ„±λλ„λ΅ μμ •: 1) 1:1 μ±„ν… κ°μ§€ λ΅μ§ μ¶”κ°€ (`isSingleChat()` ν™μ©) 2) 1:1 μ±„ν… μ‹ `singleChatListOrder`, `allChatListOrder`, `partnerUid`, `roomType` μλ™ μ„¤μ • 3) κ·Έλ£Ή/μ¤ν” μ±„ν… μ‹ `chat-rooms` μ΅°ν ν›„ `roomType`, `roomName`, `allChatListOrder` λ° νƒ€μ…λ³„ μ •λ ¬ ν•„λ“ μ„¤μ • 4) μ΄λ―Έ μ™„μ „ν μ„¤μ •λ κ²½μ° (`joinedAt` + `roomType` μ΅΄μ¬) κ±΄λ„λ›°κΈ° μµμ ν™” 5) `index.ts`μ `onChatJoinCreate` JSDoc μ£Όμ„ μ—…λ°μ΄νΈν•μ—¬ μƒ λ΅μ§ λ°μ 6) Firebase Functions λ°°ν¬ μ™„λ£. |
| 2025-11-13 | Claude Code | μΉκµ¬ νμ΄μ§€(chat/list) μ •λ ¬ ν•„λ“ μμ •: 1:1 μ±„ν…λ°©λ§ ν‘μ‹ν•λ„λ΅ `allChatListOrder` β†’ `singleChatListOrder` λ³€κ²½. `chat/list/+page.svelte`μ `JOIN_ORDER_FIELD` μƒμ λ° ν…ν”λ¦Ώ λ‚΄ λ³€μλ… μ—…λ°μ΄νΈ. |
| 2025-11-13 | Claude Code | ν΄λΌμ΄μ–ΈνΈ μ±„ν…λ°© μ…μ¥ ν•¨μ μμ • λ° `displayNameLowerCase` μλ™ μƒμ„± λ΅μ§ κ°μ„ : 1) `chat.functions.ts`μ `createSingleChatJoin` ν•¨μλ…μ„ `enterSingleChatRoom`μΌλ΅ λ³€κ²½ν•κ³  `set()` λ€μ‹  `update()` μ‚¬μ©μΌλ΅ κΈ°μ΅΄ λ°μ΄ν„° λ³΄μ΅΄ν•λ„λ΅ μμ • 2) `user.handler.ts`μ `handleUserUpdate`μ—μ„ `displayNameLowerCase` ν•„λ“κ°€ μ—†μΌλ©΄ μλ™ μƒμ„±ν•λ„λ΅ λ΅μ§ κ°μ„  (κΈ°μ΅΄: displayName λ³€κ²½ μ‹μ—λ§ μƒμ„± β†’ κ°μ„ : displayNameLowerCase ν•„λ“ μ—†κ±°λ‚ displayName λ³€κ²½ μ‹ μƒμ„±) 3) `types/index.ts`μ `UserData` μΈν„°νμ΄μ¤μ— `displayNameLowerCase` ν•„λ“ μ¶”κ°€ 4) Firebase Functions λ°°ν¬ μ™„λ£. |
| 2025-11-13 | Claude Code | `handleChatRoomMemberJoin` ν•¨μ κ°μ„ : μ‚¬μ©μκ°€ μ±„ν…λ°©μ— μ…μ¥ν•  λ• λ§μ§€λ§‰ λ©”μ‹μ§€ μ •λ³΄λ¥Ό μλ™μΌλ΅ μ €μ¥ν•λ„λ΅ μμ •. 1) `chat-messages`μ—μ„ `roomOrder` ν•„λ“λ΅ ν•΄λ‹Ή μ±„ν…λ°©μ λ§μ§€λ§‰ λ©”μ‹μ§€ μ΅°ν (limitToLast(1) μ‚¬μ©) 2) λ§μ§€λ§‰ λ©”μ‹μ§€μ `text`μ™€ `createdAt` κ°’μ„ μ½μ–΄μ„ `lastMessageText`, `lastMessageAt`μΌλ΅ λ³€ν™ 3) `chat-joins/{uid}/{roomId}`μ— λ§μ§€λ§‰ λ©”μ‹μ§€ μ •λ³΄ μ €μ¥ (λ©”μ‹μ§€κ°€ μλ” κ²½μ°μ—λ§) 4) ν•¨μ JSDoc μ£Όμ„ μ—…λ°μ΄νΈ 5) Firebase Functions λΉλ“ λ° λ°°ν¬ μ™„λ£. |
| 2025-11-13 | Claude Code | `/chat-joins/` λ°μ΄ν„° κµ¬μ΅° μμ  λ³΄μ™„: λ„λ½λμ—λ μ •λ ¬ ν•„λ“λ“¤μ„ λ¨λ“  μ±„ν…λ°© νƒ€μ… μμ μ— μ¶”κ°€ν•μ—¬ λ¬Έμ„ μ™„μ„±λ„ ν–¥μƒ. 1) 1:1 μ±„ν… μμ μ— `singleChatListOrder`, `allChatListOrder` μ¶”κ°€ 2) κ·Έλ£Ή μ±„ν… μμ μ— `groupChatListOrder`, `openAndGroupChatListOrder`, `allChatListOrder` λ° `roomName` μ¶”κ°€ 3) μ¤ν” μ±„ν… μμ  μ‹ κ· μ¶”κ°€ (`open-discussion`) - `openChatListOrder`, `openAndGroupChatListOrder`, `allChatListOrder` ν¬ν•¨ 4) κ° μ •λ ¬ ν•„λ“μ— μ„¤λ… μ£Όμ„ μ¶”κ°€ (μ½μ§€ μ•μ€ λ©”μ‹μ§€ κ°μ, μ©λ„ λ“±) 5) `listOrder` ν•„λ“μ— μ‚¬μ© μ¤‘λ‹¨ μμ • μ£Όμ„ μ¶”κ°€. μ΄λ΅μ¨ λ°μ΄ν„° κµ¬μ΅° μμ κ°€ ν•„λ“ μ„¤λ… ν…μ΄λΈ”κ³Ό μΌμΉν•κ² λμ–΄ κ°λ°μκ°€ μ‹¤μ  κµ¬μ΅°λ¥Ό λ” μ μ΄ν•΄ν•  μ μκ² λ¨. |
| 2025-11-13 | Claude Code | μ±„ν…λ°© μ…μ¥ μ‹ `newMessageCount` μλ™ μ΄κΈ°ν™” κΈ°λ¥ κµ¬ν„: μ‚¬μ©μκ°€ μ±„ν…λ°©μ— μ…μ¥ν•  λ•λ§λ‹¤ `/chat-joins/{uid}/{roomId}/newMessageCount`λ¥Ό 0μΌλ΅ μ΄κΈ°ν™”ν•μ—¬ λ©”μ‹μ§€λ¥Ό λ¨λ‘ μ½μ€ κ²ƒμΌλ΅ ν‘μ‹. 1) `enterSingleChatRoom()` ν•¨μ μμ • (1:1 μ±„ν…μ©) - `chat-joins` μ—…λ°μ΄νΈ μ‹ `newMessageCount: 0` μ¶”κ°€ 2) `joinChatRoom()` ν•¨μ μμ • (κ·Έλ£Ή/μ¤ν” μ±„ν…μ©) - members λ“±λ΅ ν›„ `chat-joins`μ—λ„ `newMessageCount: 0` μ„¤μ • μ¶”κ°€ 3) λ‘ ν•¨μμ JSDoc μ£Όμ„ μ—…λ°μ΄νΈν•μ—¬ μƒ λ™μ‘ λ¬Έμ„ν™”. μ΄λ΅μ¨ μ‚¬μ©μκ°€ μ±„ν…λ°© νμ΄μ§€(`/chat/room`)μ— λ“¤μ–΄κ° λ•λ§λ‹¤ `$effect` ν›…μ΄ μλ™μΌλ΅ μ‹¤ν–‰λμ–΄ μ½μ§€ μ•μ€ λ©”μ‹μ§€ μΉ΄μ΄νΈκ°€ 0μΌλ΅ μ΄κΈ°ν™”λ¨. μμ • νμΌ: `src/lib/functions/chat.functions.ts` |
| 2025-11-13 | Claude Code | μ±„ν…λ°© ν—¤λ” λ©”λ‰΄ κΈ°λ¥ κµ¬ν„: `/chat/room` νμ΄μ§€ μƒλ‹¨μ— λ„¤λΉ„κ²μ΄μ… λ° λ©”λ‰΄ μ¶”κ°€. 1) **ν—¤λ” κµ¬μ΅°**: λ’¤λ΅κ°€κΈ° λ²„νΌ, μ±„ν… μ •λ³΄ (1:1: ν”„λ΅ν•„ μ‚¬μ§„+μ΄λ¦„ / κ·Έλ£ΉΒ·μ¤ν”: λ°© μ΄λ¦„), λ©”λ‰΄ λ²„νΌμ„ κ°€λ΅λ΅ λ°°μΉ 2) **λ“λ΅­λ‹¤μ΄ λ©”λ‰΄**: shadcn-svelteμ `DropdownMenu` μ»΄ν¬λ„νΈ ν™μ©ν•μ—¬ 7κ° λ©”λ‰΄ ν•­λ© κµ¬ν„ (λ¶λ§ν¬, ν•€: μƒλ‹¨κ³ μ •, URL λ³µμ‚¬, λ©¤λ²„ λ©λ΅, λ°© νƒν‡΄ν•κΈ°, μ‹ κ³ ν•κ³  νƒν‡΄ν•κΈ°, λ‹«κΈ°) 3) **κΈ°λ¥ κµ¬ν„**: `handleGoBack()` (μ±„ν… λ©λ΅μΌλ΅ μ΄λ™), `handleCopyUrl()` (ν„μ¬ URL ν΄λ¦½λ³΄λ“ λ³µμ‚¬), `handleLeaveRoom()` (`leaveChatRoom()` νΈμ¶ ν›„ λ©λ΅ μ΄λ™, ν™•μΈ λ‹¤μ΄μ–Όλ΅κ·Έ ν¬ν•¨) 4) **νƒ€μ… μ ν‹Έλ¦¬ν‹° μ¶”κ°€**: `$lib/utils.ts`μ— shadcn-svelte μ»΄ν¬λ„νΈμ© νƒ€μ… μ¶”κ°€ (`WithElementRef`, `WithoutChild`, `WithoutChildrenOrChild`) 5) **shadcn-svelte μ„¤μΉ**: `npx shadcn-svelte add dropdown-menu` μ‹¤ν–‰ 6) μΌλ¶€ λ©”λ‰΄λ” TODO placeholderλ΅ ν–¥ν›„ κµ¬ν„ μμ • (λ¶λ§ν¬, ν•€, λ©¤λ²„ λ©λ΅, μ‹ κ³ ). μμ • νμΌ: `src/routes/chat/room/+page.svelte`, `src/lib/utils.ts` |
| 2025-11-13 | Claude Sonnet 4.5 | μ±„ν…λ°© ν•€ κΈ°λ¥ Critical Bug μμ •: `onValueUpdated` νΈλ¦¬κ±°κ°€ pin ν•„λ“ μƒμ„±/μ‚­μ  μ‹ μ‘λ™ν•μ§€ μ•λ” λ¬Έμ  ν•΄κ²°. 1) `handleChatRoomPinUpdate` ν•¨μλ¥Ό `handleChatRoomPinCreate`μ™€ `handleChatRoomPinDelete` λ‘ κ°μ ν•¨μλ΅ λ¶„λ¦¬ (chat.handler.ts) 2) `onValueUpdated` νΈλ¦¬κ±°λ¥Ό `onValueCreated`μ™€ `onValueDeleted` λ‘ κ°μ νΈλ¦¬κ±°λ΅ λ¶„λ¦¬ (index.ts) 3) κ° νΈλ¦¬κ±°μ—μ„ μ μ ν• λΉ„μ¦λ‹μ¤ λ΅μ§ ν•Έλ“¤λ¬ νΈμ¶ 4) μƒμ„Έν• JSDoc μ£Όμ„ μ¶”κ°€ν•μ—¬ νΈλ¦¬κ±° μ΅°κ±΄, μν–‰ μ‘μ—…, prefix κ·μΉ™ λ…μ‹ 5) Firebase Functions λ°°ν¬ μ™„λ£ (κΈ°μ΅΄ onChatRoomPinUpdate μ‚­μ , μƒ ν•¨μ 2κ° μƒμ„±). λ¬Έμ„ μ—…λ°μ΄νΈ: ν•€ μ²λ¦¬ μ„Ήμ…μ— νΈλ¦¬κ±° λ¶„λ¦¬ μ΄μ  μ¶”κ°€, Cloud Functions μλ™ μ²λ¦¬ μμ  μ½”λ“ μ—…λ°μ΄νΈ. |
