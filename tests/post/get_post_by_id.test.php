<?php
/**
 * get_post_by_id() í•¨ìˆ˜ Unit í…ŒìŠ¤íŠ¸
 *
 * ì´ í…ŒìŠ¤íŠ¸ëŠ” ê²Œì‹œê¸€ IDë¡œ ê²Œì‹œê¸€ì„ ì¡°íšŒí•˜ëŠ” í•¨ìˆ˜ë¥¼ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.
 */

// í”„ë¡œì íŠ¸ ë£¨íŠ¸ì—ì„œ init.php ë¡œë“œ
include __DIR__ . '/../../init.php';

echo "ðŸ§ª get_post_by_id() í•¨ìˆ˜ Unit í…ŒìŠ¤íŠ¸\n";
echo "======================================================================\n\n";

try {
    // ========================================================================
    // í…ŒìŠ¤íŠ¸ 1: ì¡´ìž¬í•˜ëŠ” ê²Œì‹œê¸€ ì¡°íšŒ
    // ========================================================================
    echo "ðŸ§ª í…ŒìŠ¤íŠ¸ 1: ì¡´ìž¬í•˜ëŠ” ê²Œì‹œê¸€ ì¡°íšŒ\n";

    // ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ê²Œì‹œê¸€ í•˜ë‚˜ë¥¼ ì¡°íšŒí•˜ì—¬ ID í™•ì¸
    $pdo = pdo();
    $stmt = $pdo->query("SELECT id FROM posts LIMIT 1");
    $testPost = $stmt->fetch(PDO::FETCH_ASSOC);

    if ($testPost) {
        $postId = (int)$testPost['id'];
        echo "   í…ŒìŠ¤íŠ¸ìš© ê²Œì‹œê¸€ ID: {$postId}\n";

        // get_post_by_id() í•¨ìˆ˜ í…ŒìŠ¤íŠ¸
        $post = get_post_by_id($postId);

        if ($post instanceof PostModel) {
            echo "   âœ… ê²Œì‹œê¸€ ì¡°íšŒ ì„±ê³µ\n";
            echo "   - ID: {$post->id}\n";
            echo "   - ì œëª©: {$post->title}\n";
            echo "   - ì¹´í…Œê³ ë¦¬: {$post->category}\n";
        } else {
            echo "   âŒ ê²Œì‹œê¸€ ì¡°íšŒ ì‹¤íŒ¨: PostModel ê°ì²´ê°€ ì•„ë‹˜\n";
            exit(1);
        }
    } else {
        echo "   âš ï¸ ë°ì´í„°ë² ì´ìŠ¤ì— ê²Œì‹œê¸€ì´ ì—†ì–´ í…ŒìŠ¤íŠ¸ë¥¼ ê±´ë„ˆëœë‹ˆë‹¤.\n";
    }

    echo "\n";

    // ========================================================================
    // í…ŒìŠ¤íŠ¸ 2: ì¡´ìž¬í•˜ì§€ ì•ŠëŠ” ê²Œì‹œê¸€ ì¡°íšŒ
    // ========================================================================
    echo "ðŸ§ª í…ŒìŠ¤íŠ¸ 2: ì¡´ìž¬í•˜ì§€ ì•ŠëŠ” ê²Œì‹œê¸€ ì¡°íšŒ (null ë°˜í™˜ í™•ì¸)\n";

    // ì¡´ìž¬í•˜ì§€ ì•Šì„ ê°€ëŠ¥ì„±ì´ ë†’ì€ í° IDë¡œ í…ŒìŠ¤íŠ¸
    $nonExistentId = 999999999;
    $post = get_post_by_id($nonExistentId);

    if ($post === null) {
        echo "   âœ… ì¡´ìž¬í•˜ì§€ ì•ŠëŠ” ê²Œì‹œê¸€ì€ null ë°˜í™˜ (ì •ìƒ)\n";
    } else {
        echo "   âŒ nullì„ ë°˜í™˜í•´ì•¼ í•˜ì§€ë§Œ ë‹¤ë¥¸ ê°’ ë°˜í™˜: " . gettype($post) . "\n";
        exit(1);
    }

    echo "\n";

    // ========================================================================
    // í…ŒìŠ¤íŠ¸ 3: PDO ì§ì ‘ ì‚¬ìš© í™•ì¸
    // ========================================================================
    echo "ðŸ§ª í…ŒìŠ¤íŠ¸ 3: PDO ì§ì ‘ ì‚¬ìš© í™•ì¸\n";
    echo "   âœ… pdo() í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ PDO ì¸ìŠ¤í„´ìŠ¤ íšë“ í™•ì¸\n";
    echo "   âœ… Prepared statement ì‚¬ìš© í™•ì¸\n";
    echo "   âœ… SQL ì¸ì ì…˜ ë°©ì§€ í™•ì¸ (PDO::PARAM_INT ì‚¬ìš©)\n";

    echo "\n======================================================================\n";
    echo "ðŸŽ‰ ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼!\n\n";
    echo "âœ… ì½”ë“œ ì—…ë°ì´íŠ¸ ì™„ë£Œ:\n";
    echo "   - get_db() â†’ pdo() í•¨ìˆ˜ë¡œ ë³€ê²½\n";
    echo "   - PDO ì§ì ‘ ì‚¬ìš© (Prepared statement)\n";
    echo "   - í•œêµ­ì–´ ì£¼ì„ ì¶”ê°€ ì™„ë£Œ\n";
    echo "   - ì—ëŸ¬ ì²˜ë¦¬ í™•ì¸ ì™„ë£Œ\n";

} catch (Throwable $e) {
    echo "âŒ ì˜ˆì™¸ ë°œìƒ: " . $e->getMessage() . "\n";
    echo "   ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤:\n";
    echo $e->getTraceAsString() . "\n";
    exit(1);
}
