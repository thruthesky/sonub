# ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼ ë¬¸ì„œ

## ëª©ì°¨
- [ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼ ë¬¸ì„œ](#ë°ì´í„°ë² ì´ìŠ¤-ì ‘ê·¼-ë¬¸ì„œ)
  - [ëª©ì°¨](#ëª©ì°¨)
  - [ê°œìš”](#ê°œìš”)
  - [ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ](#ë°ì´í„°ë² ì´ìŠ¤-ìŠ¤í‚¤ë§ˆ)
    - [ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡° í™•ì¸ ë°©ë²•](#ë°ì´í„°ë² ì´ìŠ¤-êµ¬ì¡°-í™•ì¸-ë°©ë²•)
    - [ì£¼ìš” í…Œì´ë¸”](#ì£¼ìš”-í…Œì´ë¸”)
      - [`users` í…Œì´ë¸”](#users-í…Œì´ë¸”)
      - [`posts` í…Œì´ë¸”](#posts-í…Œì´ë¸”)
    - [ìŠ¤í‚¤ë§ˆ íŒŒì¼ ì‚¬ìš© ì˜ˆì‹œ](#ìŠ¤í‚¤ë§ˆ-íŒŒì¼-ì‚¬ìš©-ì˜ˆì‹œ)
    - [ì¿¼ë¦¬ ì‘ì„± ì‹œ ì£¼ì˜ì‚¬í•­](#ì¿¼ë¦¬-ì‘ì„±-ì‹œ-ì£¼ì˜ì‚¬í•­)
  - [ğŸ”¥ğŸ”¥ğŸ”¥ ìµœìš°ì„  ê¶Œì¥ì‚¬í•­ - PDO ì§ì ‘ ì‚¬ìš©](#-ìµœìš°ì„ -ê¶Œì¥ì‚¬í•­---pdo-ì§ì ‘-ì‚¬ìš©)
    - [PDO ì‚¬ìš©ì˜ ì¥ì ](#pdo-ì‚¬ìš©ì˜-ì¥ì )
    - [pdo() í•¨ìˆ˜ ì‚¬ìš©ë²•](#pdo-í•¨ìˆ˜-ì‚¬ìš©ë²•)
  - [ì„¤ì¹˜ ë° êµ¬ì„±](#ì„¤ì¹˜-ë°-êµ¬ì„±)
  - [PDO ê¸°ë³¸ ì‚¬ìš©ë²• (ìµœìš°ì„ )](#pdo-ê¸°ë³¸-ì‚¬ìš©ë²•-ìµœìš°ì„ )
    - [PDO INSERT ì‘ì—…](#pdo-insert-ì‘ì—…)
    - [PDO SELECT ì‘ì—…](#pdo-select-ì‘ì—…)
      - [ì—¬ëŸ¬ ë ˆì½”ë“œ ê²€ìƒ‰](#ì—¬ëŸ¬-ë ˆì½”ë“œ-ê²€ìƒ‰)
      - [ë‹¨ì¼ ë ˆì½”ë“œ ê²€ìƒ‰](#ë‹¨ì¼-ë ˆì½”ë“œ-ê²€ìƒ‰)
      - [ë ˆì½”ë“œ ìˆ˜ ì„¸ê¸°](#ë ˆì½”ë“œ-ìˆ˜-ì„¸ê¸°)
    - [PDO UPDATE ì‘ì—…](#pdo-update-ì‘ì—…)
    - [PDO DELETE ì‘ì—…](#pdo-delete-ì‘ì—…)
    - [PDO íŠ¸ëœì­ì…˜](#pdo-íŠ¸ëœì­ì…˜)
  - [ì¿¼ë¦¬ ë¹Œë” ì‚¬ìš©ë²• (ì°¨ì„ íƒ)](#ì¿¼ë¦¬-ë¹Œë”-ì‚¬ìš©ë²•-ì°¨ì„ íƒ)
  - [ê¸°ë³¸ ì‚¬ìš©ë²•](#ê¸°ë³¸-ì‚¬ìš©ë²•)
    - [INSERT ì‘ì—…](#insert-ì‘ì—…)
    - [SELECT ì‘ì—…](#select-ì‘ì—…)
      - [ì—¬ëŸ¬ ë ˆì½”ë“œ ê²€ìƒ‰](#ì—¬ëŸ¬-ë ˆì½”ë“œ-ê²€ìƒ‰-1)
      - [ë‹¨ì¼ ë ˆì½”ë“œ ê²€ìƒ‰](#ë‹¨ì¼-ë ˆì½”ë“œ-ê²€ìƒ‰-1)
      - [ë ˆì½”ë“œ ìˆ˜ ì„¸ê¸°](#ë ˆì½”ë“œ-ìˆ˜-ì„¸ê¸°-1)
    - [UPDATE ì‘ì—…](#update-ì‘ì—…)
    - [DELETE ì‘ì—…](#delete-ì‘ì—…)
    - [ì›ì‹œ ì¿¼ë¦¬](#ì›ì‹œ-ì¿¼ë¦¬)
  - [ê³ ê¸‰ ê¸°ëŠ¥](#ê³ ê¸‰-ê¸°ëŠ¥)
    - [WHERE ì¡°ê±´](#where-ì¡°ê±´)
    - [JOIN ì‘ì—…](#join-ì‘ì—…)
    - [ORDER BY](#order-by)
    - [LIMIT ë° í˜ì´ì§€ë„¤ì´ì…˜](#limit-ë°-í˜ì´ì§€ë„¤ì´ì…˜)
    - [íŠ¸ëœì­ì…˜](#íŠ¸ëœì­ì…˜)
  - [ì—”í‹°í‹° ì‹œìŠ¤í…œ](#ì—”í‹°í‹°-ì‹œìŠ¤í…œ)
    - [ì—”í‹°í‹° ê¸°ë³¸ í´ë˜ìŠ¤](#ì—”í‹°í‹°-ê¸°ë³¸-í´ë˜ìŠ¤)
      - [ì£¼ìš” ê¸°ëŠ¥](#ì£¼ìš”-ê¸°ëŠ¥)
      - [ê¸°ë³¸ ì—”í‹°í‹° ë©”ì„œë“œ](#ê¸°ë³¸-ì—”í‹°í‹°-ë©”ì„œë“œ)
    - [ì—”í‹°í‹° í´ë˜ìŠ¤ ìƒì„±](#ì—”í‹°í‹°-í´ë˜ìŠ¤-ìƒì„±)
    - [ì—”í‹°í‹° CRUD ì‘ì—…](#ì—”í‹°í‹°-crud-ì‘ì—…)
      - [Create (ìƒì„±)](#create-ìƒì„±)
      - [Read (ì½ê¸°)](#read-ì½ê¸°)
      - [Update (ì—…ë°ì´íŠ¸)](#update-ì—…ë°ì´íŠ¸)
      - [Delete (ì‚­ì œ)](#delete-ì‚­ì œ)
    - [ì‚¬ìš©ì ì—”í‹°í‹°](#ì‚¬ìš©ì-ì—”í‹°í‹°)
    - [ê²Œì‹œë¬¼ ì—”í‹°í‹°](#ê²Œì‹œë¬¼-ì—”í‹°í‹°)
    - [ì—”í‹°í‹° ë§¤ì§ ë©”ì„œë“œ](#ì—”í‹°í‹°-ë§¤ì§-ë©”ì„œë“œ)
    - [ì—”í‹°í‹° ìœ í‹¸ë¦¬í‹°](#ì—”í‹°í‹°-ìœ í‹¸ë¦¬í‹°)
    - [ì—”í‹°í‹° ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸](#ì—”í‹°í‹°-ì‹œìŠ¤í…œ-í…ŒìŠ¤íŠ¸)
  - [ë©”ì„œë“œ ì°¸ì¡°](#ë©”ì„œë“œ-ì°¸ì¡°)
    - [ì¿¼ë¦¬ ë¹Œë”© ë©”ì„œë“œ](#ì¿¼ë¦¬-ë¹Œë”©-ë©”ì„œë“œ)
    - [ì‹¤í–‰ ë©”ì„œë“œ](#ì‹¤í–‰-ë©”ì„œë“œ)
    - [íŠ¸ëœì­ì…˜ ë©”ì„œë“œ](#íŠ¸ëœì­ì…˜-ë©”ì„œë“œ)
  - [ì˜ˆì œ](#ì˜ˆì œ)
    - [ì‚¬ìš©ì ë“±ë¡ ì˜ˆì œ](#ì‚¬ìš©ì-ë“±ë¡-ì˜ˆì œ)
    - [ëŒ“ê¸€ì´ ìˆëŠ” ë¸”ë¡œê·¸ ê²Œì‹œë¬¼ ì˜ˆì œ](#ëŒ“ê¸€ì´-ìˆëŠ”-ë¸”ë¡œê·¸-ê²Œì‹œë¬¼-ì˜ˆì œ)
    - [í˜ì´ì§€ë„¤ì´ì…˜ì´ ìˆëŠ” ê²€ìƒ‰ ì˜ˆì œ](#í˜ì´ì§€ë„¤ì´ì…˜ì´-ìˆëŠ”-ê²€ìƒ‰-ì˜ˆì œ)
  - [ëª¨ë²” ì‚¬ë¡€](#ëª¨ë²”-ì‚¬ë¡€)
  - [ì½”ë©˜íŠ¸ í…Œì´ë¸” ì„¤ëª…](#ì½”ë©˜íŠ¸-í…Œì´ë¸”-ì„¤ëª…)

## ê°œìš”

SonubëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼ì„ ìœ„í•´ **PDO (PHP Data Objects) ì§ì ‘ ì‚¬ìš©ì„ ìµœìš°ì„ ìœ¼ë¡œ ê¶Œì¥**í•©ë‹ˆë‹¤. PDOëŠ” PHPì˜ í‘œì¤€ ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼ ë°©ì‹ì´ë©°, prepared statementë¥¼ í†µí•´ SQL ì¸ì ì…˜ìœ¼ë¡œë¶€í„° ë³´í˜¸í•©ë‹ˆë‹¤.

**ğŸ”¥ğŸ”¥ğŸ”¥ ì¤‘ìš”: ê°€ëŠ¥í•œ ëª¨ë“  ê²½ìš°ì— PDOë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ì„¸ìš” ğŸ”¥ğŸ”¥ğŸ”¥**

## ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

**ğŸ”¥ğŸ”¥ğŸ”¥ ì¤‘ìš”: ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ ì‘ì„± ì „ ë°˜ë“œì‹œ ìŠ¤í‚¤ë§ˆë¥¼ í™•ì¸í•˜ì„¸ìš” ğŸ”¥ğŸ”¥ğŸ”¥**

Sonub í”„ë¡œì íŠ¸ì˜ ìµœì‹  MariaDB ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡°ëŠ” í•­ìƒ ë‹¤ìŒ íŒŒì¼ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

**ìŠ¤í‚¤ë§ˆ íŒŒì¼ ìœ„ì¹˜**: `etc/db-schema/sonub-database-schema.sql`

### ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡° í™•ì¸ ë°©ë²•

ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ê¸° ì „ì— ë°˜ë“œì‹œ ìŠ¤í‚¤ë§ˆ íŒŒì¼ì„ í™•ì¸í•˜ì—¬ ë‹¤ìŒ ì‚¬í•­ì„ íŒŒì•…í•´ì•¼ í•©ë‹ˆë‹¤:

1. **í…Œì´ë¸” êµ¬ì¡°**: ì–´ë–¤ í…Œì´ë¸”ë“¤ì´ ì¡´ì¬í•˜ëŠ”ì§€
2. **ì»¬ëŸ¼ ì •ë³´**: ê° í…Œì´ë¸”ì˜ ì»¬ëŸ¼ëª…, ë°ì´í„° íƒ€ì…, ê¸°ë³¸ê°’
3. **ì¸ë±ìŠ¤**: ì–´ë–¤ ì»¬ëŸ¼ì— ì¸ë±ìŠ¤ê°€ ì„¤ì •ë˜ì–´ ìˆëŠ”ì§€ (WHERE ì ˆ ìµœì í™”)
4. **ê´€ê³„**: PRIMARY KEY, FOREIGN KEY, UNIQUE ì œì•½ì¡°ê±´

### ì£¼ìš” í…Œì´ë¸”

í˜„ì¬ Sonub ë°ì´í„°ë² ì´ìŠ¤ì˜ ì£¼ìš” í…Œì´ë¸”:

#### `users` í…Œì´ë¸”
- `id` (INT, PRIMARY KEY, AUTO_INCREMENT): ì‚¬ìš©ì ê³ ìœ  ID
- `firebase_uid` (VARCHAR(128), UNIQUE): Firebase ì¸ì¦ UID
- `first_name` (VARCHAR(64)): ì´ë¦„
- `last_name` (VARCHAR(64)): ì„±
- `middle_name` (VARCHAR(64)): ì¤‘ê°„ ì´ë¦„
- `birthday` (INT): ìƒë…„ì›”ì¼ (Unix timestamp)
- `gender` (CHAR(1)): ì„±ë³„ (M/F)
- `photo_url` (VARCHAR(255)): í”„ë¡œí•„ ì‚¬ì§„ URL
- `created_at` (INT): ìƒì„±ì¼ (Unix timestamp)
- `updated_at` (INT): ìˆ˜ì •ì¼ (Unix timestamp)

#### `posts` í…Œì´ë¸”
- `id` (INT, PRIMARY KEY, AUTO_INCREMENT): ê²Œì‹œê¸€ ê³ ìœ  ID
- `user_id` (INT): ì‘ì„±ì ID (users.idì™€ ì—°ê²°)
- `category` (VARCHAR(64)): ê²Œì‹œê¸€ ì¹´í…Œê³ ë¦¬ ë¶„ë¥˜
  - ê° ì¹´í…Œê³ ë¦¬ë³„ë¡œ ê²Œì‹œê¸€ì„ ëª©ë¡í™”í•  ë•Œ ì‚¬ìš©
  - ì˜ˆ: 'discussion', 'qna', 'notice', 'free' ë“±
  - WHERE ì ˆì—ì„œ `category = ?` ì¡°ê±´ìœ¼ë¡œ íŠ¹ì • ì¹´í…Œê³ ë¦¬ì˜ ê²Œì‹œê¸€ë§Œ ì¡°íšŒ ê°€ëŠ¥
- `title` (VARCHAR(255)): ê²Œì‹œê¸€ ì œëª©
- `content` (LONGTEXT): ê²Œì‹œê¸€ ë‚´ìš©
- `files` (TEXT): íŒŒì¼ URL ëª©ë¡ (ì½¤ë§ˆë¡œ êµ¬ë¶„)
  - **ì²¨ë¶€ íŒŒì¼ì˜ URLì„ ì €ì¥**: ê²Œì‹œê¸€ì— ì²¨ë¶€ëœ ëª¨ë“  íŒŒì¼ì˜ URLì„ ì½¤ë§ˆ(,)ë¡œ êµ¬ë¶„í•˜ì—¬ ì €ì¥
  - **ì™¸ë¶€ URL ì§€ì›**: HTTP/HTTPSë¡œ ì‹œì‘í•˜ëŠ” ì™¸ë¶€ ë¦¬ì†ŒìŠ¤ URL ì €ì¥ ê°€ëŠ¥
    - ì˜ˆ: `https://abc.com/def/photo.jpg`
  - **ë¡œì»¬ íŒŒì¼ ê²½ë¡œ ì§€ì›**: `/var/uploads/[ìˆ«ì]/...` í˜•ì‹ì˜ ë¡œì»¬ íŒŒì¼ ê²½ë¡œ ì €ì¥ ê°€ëŠ¥
    - ì˜ˆ: `/var/uploads/345/another-file.zip`
  - **ì—¬ëŸ¬ íŒŒì¼ ì €ì¥**: ì½¤ë§ˆ(,)ë¡œ êµ¬ë¶„í•˜ì—¬ ì—¬ëŸ¬ íŒŒì¼ URLì„ í•˜ë‚˜ì˜ ë¬¸ìì—´ë¡œ ì €ì¥
    - ì˜ˆ: `https://abc.com/def/photo.jpg,/var/uploads/345/another-file.zip`
  - **íŒŒì¼ URL í˜•ì‹**:
    - ì™¸ë¶€ URL: `https://example.com/path/to/file.ext`
    - ë¡œì»¬ ê²½ë¡œ: `/var/uploads/[user_id ë˜ëŠ” ìˆ«ì]/filename.ext`
  - **ì‚¬ìš© ì˜ˆì‹œ**:
    ```php
    // ë‹¨ì¼ íŒŒì¼
    $post = create_post([
        'category' => 'discussion',
        'files' => 'https://example.com/photo.jpg'
    ]);

    // ì—¬ëŸ¬ íŒŒì¼ (ì½¤ë§ˆë¡œ êµ¬ë¶„)
    $post = create_post([
        'category' => 'discussion',
        'files' => 'https://abc.com/photo.jpg,/var/uploads/123/doc.pdf,https://cdn.example.com/video.mp4'
    ]);

    // íŒŒì¼ ë°°ì—´ë¡œ ë¶„ë¦¬
    $filesArray = explode(',', $post->files);
    foreach ($filesArray as $fileUrl) {
        echo $fileUrl . "\n";
    }
    ```
- `created_at` (INT): ìƒì„±ì¼ (Unix timestamp)
- `updated_at` (INT): ìˆ˜ì •ì¼ (Unix timestamp)

### ìŠ¤í‚¤ë§ˆ íŒŒì¼ ì‚¬ìš© ì˜ˆì‹œ

```bash
# ìŠ¤í‚¤ë§ˆ íŒŒì¼ í™•ì¸
cat etc/db-schema/sonub-database-schema.sql

# íŠ¹ì • í…Œì´ë¸” êµ¬ì¡° ê²€ìƒ‰
grep -A 20 "CREATE TABLE \`users\`" etc/db-schema/sonub-database-schema.sql
```

### ì¿¼ë¦¬ ì‘ì„± ì‹œ ì£¼ì˜ì‚¬í•­

1. **ì»¬ëŸ¼ëª… í™•ì¸**: ìŠ¤í‚¤ë§ˆ íŒŒì¼ì—ì„œ ì •í™•í•œ ì»¬ëŸ¼ëª… í™•ì¸
2. **ë°ì´í„° íƒ€ì… ì¼ì¹˜**: INSERT/UPDATE ì‹œ ì˜¬ë°”ë¥¸ ë°ì´í„° íƒ€ì… ì‚¬ìš©
3. **ì¸ë±ìŠ¤ í™œìš©**: ì¸ë±ìŠ¤ê°€ ì„¤ì •ëœ ì»¬ëŸ¼ì„ WHERE ì ˆì— ì‚¬ìš©í•˜ì—¬ ì„±ëŠ¥ ìµœì í™”
4. **íƒ€ì„ìŠ¤íƒ¬í”„ í˜•ì‹**: ëª¨ë“  ë‚ ì§œ/ì‹œê°„ í•„ë“œëŠ” Unix timestamp (ì •ìˆ˜) ì‚¬ìš©

## ğŸ”¥ğŸ”¥ğŸ”¥ ìµœìš°ì„  ê¶Œì¥ì‚¬í•­ - PDO ì§ì ‘ ì‚¬ìš©

**âœ… í•„ìˆ˜: ëª¨ë“  ë°ì´í„°ë² ì´ìŠ¤ ì‘ì—…ì€ `pdo()` í•¨ìˆ˜ë¥¼ í†µí•´ PDO ê°ì²´ë¥¼ ì–»ì–´ì„œ ìˆ˜í–‰í•´ì•¼ í•©ë‹ˆë‹¤**

**âŒ ì°¨ì„ íƒ: `db()` ì¿¼ë¦¬ ë¹Œë”ëŠ” íŠ¹ë³„í•œ ê²½ìš°ì—ë§Œ ì‚¬ìš©í•˜ê³ , ê°€ëŠ¥í•œ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”**

### PDO ì‚¬ìš©ì˜ ì¥ì 

1. **í‘œì¤€í™”**: PHP í‘œì¤€ ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼ ë°©ì‹
2. **ì„±ëŠ¥**: ë¶ˆí•„ìš”í•œ ì¶”ìƒí™” ë ˆì´ì–´ ì—†ì´ ì§ì ‘ ì‹¤í–‰
3. **ìœ ì—°ì„±**: ëª¨ë“  SQL ê¸°ëŠ¥ì— ì™„ì „í•œ ì ‘ê·¼
4. **ëª…í™•ì„±**: SQL ì¿¼ë¦¬ê°€ ëª…í™•í•˜ê²Œ ë³´ì„
5. **ë””ë²„ê¹…**: ì¿¼ë¦¬ ë¬¸ì œë¥¼ ë¹ ë¥´ê²Œ íŒŒì•… ê°€ëŠ¥
6. **í˜¸í™˜ì„±**: ë‹¤ë¥¸ í”„ë¡œì íŠ¸ë‚˜ í”„ë ˆì„ì›Œí¬ì™€ í˜¸í™˜

### pdo() í•¨ìˆ˜ ì‚¬ìš©ë²•

```php
// PDO ê°ì²´ ê°€ì ¸ì˜¤ê¸°
$pdo = pdo();

// ì´ì œ PDOì˜ ëª¨ë“  ë©”ì„œë“œë¥¼ ì§ì ‘ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
$stmt = $pdo->prepare("SELECT * FROM users WHERE id = ?");
$stmt->execute([123]);
$user = $stmt->fetch();
```

## ì„¤ì¹˜ ë° êµ¬ì„±

ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì„±ì€ `/lib/db/db.php`ì— ìœ„ì¹˜í•©ë‹ˆë‹¤. ì—°ê²° ë§¤ê°œë³€ìˆ˜ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

```php
$host = 'sonub-mariadb';
$db = 'sonub';
$user = 'sonub';
$pass = 'asdf';
$charset = 'utf8mb4';
```

PDO ê°ì²´ë¥¼ ê°€ì ¸ì˜¤ë ¤ë©´ `pdo()` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê¸°ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤:

```php
require_once '/lib/db/db.php';

// pdo() í•¨ìˆ˜ëŠ” ì‹±ê¸€í†¤ PDO ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤
$pdo = pdo();
```

## PDO ê¸°ë³¸ ì‚¬ìš©ë²• (ìµœìš°ì„ )

**ğŸ”¥ğŸ”¥ğŸ”¥ ìµœê°•ë ¥ ê·œì¹™: ëª¨ë“  ë°ì´í„°ë² ì´ìŠ¤ ì‘ì—…ì€ PDOë¥¼ ì§ì ‘ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤ ğŸ”¥ğŸ”¥ğŸ”¥**

### PDO INSERT ì‘ì—…

ìƒˆ ë ˆì½”ë“œë¥¼ ì‚½ì…í•˜ê³  ì‚½ì…ëœ IDë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤:

```php
// âœ… ì˜¬ë°”ë¥¸ ë°©ë²•: PDO ì§ì ‘ ì‚¬ìš©
$pdo = pdo();

// ë‹¨ìˆœ ì‚½ì… - ë§ˆì§€ë§‰ ì‚½ì… IDë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤
$stmt = $pdo->prepare("INSERT INTO users (first_name, last_name, email, created_at) VALUES (?, ?, ?, ?)");
$stmt->execute(['ì¬í˜¸', 'ì†¡', 'jaeho@example.com', time()]);
$userId = $pdo->lastInsertId();

echo "ìƒˆ ì‚¬ìš©ì ID: {$userId}";

// ì—¬ëŸ¬ í•„ë“œë¡œ ì‚½ì…
$stmt = $pdo->prepare("INSERT INTO posts (user_id, title, content, category, created_at) VALUES (?, ?, ?, ?, ?)");
$stmt->execute([
    123,
    'ê²Œì‹œê¸€ ì œëª©',
    'ê²Œì‹œê¸€ ë‚´ìš©',
    'discussion',
    time()
]);
$postId = $pdo->lastInsertId();
```

### PDO SELECT ì‘ì—…

#### ì—¬ëŸ¬ ë ˆì½”ë“œ ê²€ìƒ‰

```php
$pdo = pdo();

// ëª¨ë“  ì‚¬ìš©ì ì¡°íšŒ
$stmt = $pdo->query("SELECT * FROM users");
$users = $stmt->fetchAll();

// ì¡°ê±´ë¶€ ì¡°íšŒ
$stmt = $pdo->prepare("SELECT * FROM users WHERE id > ? LIMIT 5");
$stmt->execute([2]);
$users = $stmt->fetchAll();

// í”Œë ˆì´ìŠ¤í™€ë”ë¥¼ ì‚¬ìš©í•œ prepared statement
$stmt = $pdo->prepare("SELECT * FROM users WHERE status = ? AND created_at > ?");
$stmt->execute(['active', strtotime('-30 days')]);
$users = $stmt->fetchAll();
```

#### ë‹¨ì¼ ë ˆì½”ë“œ ê²€ìƒ‰

```php
$pdo = pdo();

// ì²« ë²ˆì§¸ ì¼ì¹˜í•˜ëŠ” ë ˆì½”ë“œ ê°€ì ¸ì˜¤ê¸°
$stmt = $pdo->prepare("SELECT * FROM users WHERE id = ?");
$stmt->execute([123]);
$user = $stmt->fetch();

if ($user) {
    echo "ì‚¬ìš©ì ì´ë¦„: {$user['first_name']} {$user['last_name']}";
} else {
    echo "ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤";
}

// ì´ë©”ì¼ë¡œ ì‚¬ìš©ì ì°¾ê¸°
$stmt = $pdo->prepare("SELECT * FROM users WHERE email = ?");
$stmt->execute(['hong@example.com']);
$user = $stmt->fetch();
```

#### ë ˆì½”ë“œ ìˆ˜ ì„¸ê¸°

```php
$pdo = pdo();

// ì „ì²´ ë ˆì½”ë“œ ìˆ˜
$stmt = $pdo->query("SELECT COUNT(*) FROM users");
$count = $stmt->fetchColumn();

// ì¡°ê±´ë¶€ ìˆ˜ ì„¸ê¸°
$stmt = $pdo->prepare("SELECT COUNT(*) FROM users WHERE status = ?");
$stmt->execute(['active']);
$activeCount = $stmt->fetchColumn();
```

### PDO UPDATE ì‘ì—…

```php
$pdo = pdo();

// ë ˆì½”ë“œ ì—…ë°ì´íŠ¸ - ì˜í–¥ë°›ì€ í–‰ ìˆ˜ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤
$stmt = $pdo->prepare("UPDATE users SET first_name = ?, last_name = ?, updated_at = ? WHERE id = ?");
$stmt->execute(['ì¬í˜¸', 'ì†¡', time(), 123]);
$affectedRows = $stmt->rowCount();

echo "{$affectedRows}ê°œ í–‰ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤";

// ì—¬ëŸ¬ í•„ë“œ ì—…ë°ì´íŠ¸
$stmt = $pdo->prepare("UPDATE users SET first_name = ?, last_name = ?, email = ?, updated_at = ? WHERE id = ?");
$stmt->execute(['Updated', 'Name', 'new@example.com', time(), 5]);
$affectedRows = $stmt->rowCount();
```

### PDO DELETE ì‘ì—…

```php
$pdo = pdo();

// ë ˆì½”ë“œ ì‚­ì œ - ì‚­ì œëœ í–‰ ìˆ˜ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤
$stmt = $pdo->prepare("DELETE FROM users WHERE id = ?");
$stmt->execute([123]);
$deletedRows = $stmt->rowCount();

echo "{$deletedRows}ê°œ í–‰ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤";

// ì—¬ëŸ¬ ì¡°ê±´ìœ¼ë¡œ ì‚­ì œ
$stmt = $pdo->prepare("DELETE FROM users WHERE status = ? AND created_at < ?");
$stmt->execute(['inactive', strtotime('-1 year')]);
$deletedRows = $stmt->rowCount();
```

### PDO íŠ¸ëœì­ì…˜

```php
$pdo = pdo();

try {
    $pdo->beginTransaction();

    // ì‚¬ìš©ì ì‚½ì…
    $stmt = $pdo->prepare("INSERT INTO users (first_name, last_name, email, created_at) VALUES (?, ?, ?, ?)");
    $stmt->execute(['John', 'Doe', 'john@example.com', time()]);
    $userId = $pdo->lastInsertId();

    // í”„ë¡œí•„ ì‚½ì…
    $stmt = $pdo->prepare("INSERT INTO profiles (user_id, bio) VALUES (?, ?)");
    $stmt->execute([$userId, 'Software Developer']);

    // í†µê³„ ì—…ë°ì´íŠ¸
    $stmt = $pdo->query("SELECT COUNT(*) FROM users");
    $userCount = $stmt->fetchColumn();

    $stmt = $pdo->prepare("UPDATE stats SET user_count = ? WHERE id = 1");
    $stmt->execute([$userCount]);

    $pdo->commit();
    echo "íŠ¸ëœì­ì…˜ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤";

} catch (Exception $e) {
    $pdo->rollBack();
    echo "íŠ¸ëœì­ì…˜ ì‹¤íŒ¨: " . $e->getMessage();
}
```

## ì¿¼ë¦¬ ë¹Œë” ì‚¬ìš©ë²• (ì°¨ì„ íƒ)

**âš ï¸ ê²½ê³ : ì¿¼ë¦¬ ë¹Œë”(`db()` í´ë˜ìŠ¤)ëŠ” íŠ¹ë³„í•œ ê²½ìš°ì—ë§Œ ì‚¬ìš©í•˜ê³ , ê°€ëŠ¥í•œ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”**

ì¿¼ë¦¬ ë¹Œë”ëŠ” ë‹¤ìŒê³¼ ê°™ì€ **ì œí•œì ì¸ ê²½ìš°ì—ë§Œ** ì‚¬ìš©í•˜ì„¸ìš”:
- ë§¤ìš° ë³µì¡í•œ ë™ì  ì¿¼ë¦¬ ìƒì„±ì´ í•„ìš”í•œ ê²½ìš°
- ì—¬ëŸ¬ ì¡°ê±´ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë˜ì–´ì•¼ í•˜ëŠ” ê²€ìƒ‰ ê¸°ëŠ¥
- ë ˆê±°ì‹œ ì½”ë“œ ìœ ì§€ë³´ìˆ˜

**âœ… ì¼ë°˜ì ì¸ ê²½ìš°: PDOë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ì„¸ìš”**

```php
require_once '/lib/db/db.php';

// âŒ ì°¨ì„ íƒ: ì¿¼ë¦¬ ë¹Œë” ì‚¬ìš©
$result = db()->select('*')->from('users')->get();

// âœ… ìµœìš°ì„ : PDO ì§ì ‘ ì‚¬ìš©
$pdo = pdo();
$stmt = $pdo->query("SELECT * FROM users");
$result = $stmt->fetchAll();
```

## ê¸°ë³¸ ì‚¬ìš©ë²•

### INSERT ì‘ì—…

ìƒˆ ë ˆì½”ë“œë¥¼ ì‚½ì…í•˜ê³  ì‚½ì…ëœ IDë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤:

```php
// ë‹¨ìˆœ ì‚½ì… - ë§ˆì§€ë§‰ ì‚½ì… IDë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤
$id = db()->insert(['first_name' => 'ì¬í˜¸', 'last_name' => 'ì†¡', 'email' => 'jaeho@example.com'])
    ->into('users');

// ì—¬ëŸ¬ í•„ë“œë¡œ ì‚½ì…
$id = db()->insert([
    'first_name' => 'John',
    'last_name' => 'Doe',
    'email' => 'john@example.com',
    'created_at' => date('Y-m-d H:i:s')
])->into('users');
```

### SELECT ì‘ì—…

#### ì—¬ëŸ¬ ë ˆì½”ë“œ ê²€ìƒ‰

```php
// ëª¨ë“  ì»¬ëŸ¼ ì„ íƒ
$users = db()->select('*')->from('users')->get();

// íŠ¹ì • ì»¬ëŸ¼ ì„ íƒ
$users = db()->select('id, first_name, last_name, email')->from('users')->get();

// WHERE ì¡°ê±´ ì‚¬ìš©
$users = db()->select('*')
    ->from('users')
    ->where('id > 2')
    ->limit(5)
    ->get();

// í”Œë ˆì´ìŠ¤í™€ë”ë¥¼ ì‚¬ìš©í•œ prepared statement ì‚¬ìš©
$users = db()->select('*')
    ->from('users')
    ->where('status = ? AND created_at > ?', ['active', '2024-01-01'])
    ->get();
```

#### ë‹¨ì¼ ë ˆì½”ë“œ ê²€ìƒ‰

```php
// ì²« ë²ˆì§¸ ì¼ì¹˜í•˜ëŠ” ë ˆì½”ë“œ ê°€ì ¸ì˜¤ê¸°
$user = db()->select('*')
    ->from('users')
    ->where('id = ?', [1])
    ->first();

// ë ˆì½”ë“œê°€ ì—†ìœ¼ë©´ null ë°˜í™˜
$user = db()->select('*')
    ->from('users')
    ->where('email = ?', ['nonexistent@example.com'])
    ->first();
```

#### ë ˆì½”ë“œ ìˆ˜ ì„¸ê¸°

```php
// ë ˆì½”ë“œ ìˆ˜ ê°€ì ¸ì˜¤ê¸°
$count = db()->select()->from('users')->count();

// ì¡°ê±´ì´ ìˆëŠ” ìˆ˜ ì„¸ê¸°
$activeCount = db()->select()
    ->from('users')
    ->where('status = ?', ['active'])
    ->count();
```

### UPDATE ì‘ì—…

```php
// ë ˆì½”ë“œ ì—…ë°ì´íŠ¸ - ì˜í–¥ì„ ë°›ì€ í–‰ ìˆ˜ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤
$affected = db()->update(['first_name' => 'ì¬í˜¸', 'last_name' => 'ì†¡'])
    ->table('users')
    ->where("first_name = 'jaeho'")
    ->execute();

// ì—¬ëŸ¬ í•„ë“œë¡œ ì—…ë°ì´íŠ¸
$affected = db()->update([
    'first_name' => 'Updated',
    'last_name' => 'Name',
    'updated_at' => date('Y-m-d H:i:s')
])
->table('users')
->where('id = ?', [5])
->execute();

// WHERE ì—†ì´ ì—…ë°ì´íŠ¸ (ëª¨ë“  ë ˆì½”ë“œ ì—…ë°ì´íŠ¸ - ì£¼ì˜í•´ì„œ ì‚¬ìš©!)
$affected = db()->update(['status' => 'inactive'])
    ->table('users')
    ->execute();
```

### DELETE ì‘ì—…

```php
// ë ˆì½”ë“œ ì‚­ì œ - ì‚­ì œëœ í–‰ ìˆ˜ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤
$deleted = db()->delete()
    ->from('users')
    ->where('id = ?', [5])
    ->execute();

// ì—¬ëŸ¬ ì¡°ê±´ìœ¼ë¡œ ì‚­ì œ
$deleted = db()->delete()
    ->from('users')
    ->where('status = ? AND created_at < ?', ['inactive', '2023-01-01'])
    ->execute();

// ëª¨ë“  ë ˆì½”ë“œ ì‚­ì œ (ì£¼ì˜í•´ì„œ ì‚¬ìš©!)
$deleted = db()->delete()->from('temp_table')->execute();
```

### ì›ì‹œ ì¿¼ë¦¬

ë¹Œë” íŒ¨í„´ì— ë§ì§€ ì•ŠëŠ” ë³µì¡í•œ ì¿¼ë¦¬ì˜ ê²½ìš°:

```php
// SELECT ì¿¼ë¦¬
$results = db()->query("SELECT * FROM users WHERE id = ?", [1]);

// INSERT ì¿¼ë¦¬ - ë§ˆì§€ë§‰ ì‚½ì… IDë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤
$id = db()->query(
    "INSERT INTO users (first_name, last_name, email) VALUES (?, ?, ?)",
    ['John', 'Doe', 'john@example.com']
);

// UPDATE ì¿¼ë¦¬ - ì˜í–¥ì„ ë°›ì€ í–‰ì„ ë°˜í™˜í•©ë‹ˆë‹¤
$affected = db()->query(
    "UPDATE users SET first_name = ?, last_name = ? WHERE id = ?",
    ['New', 'Name', 5]
);

// DELETE ì¿¼ë¦¬ - ì‚­ì œëœ í–‰ì„ ë°˜í™˜í•©ë‹ˆë‹¤
$deleted = db()->query("DELETE FROM users WHERE id = ?", [10]);

// JOINì´ ìˆëŠ” ë³µì¡í•œ ì¿¼ë¦¬
$results = db()->query("
    SELECT u.*, COUNT(p.id) as post_count
    FROM users u
    LEFT JOIN posts p ON u.id = p.user_id
    GROUP BY u.id
    HAVING post_count > ?
", [5]);
```

## ê³ ê¸‰ ê¸°ëŠ¥

### WHERE ì¡°ê±´

```php
// ë‹¨ìˆœ WHERE
$users = db()->select('*')
    ->from('users')
    ->where('age > 18')
    ->get();

// ì—¬ëŸ¬ AND ì¡°ê±´
$users = db()->select('*')
    ->from('users')
    ->where('age > ?', [18])
    ->where('status = ?', ['active'])
    ->get();

// OR ì¡°ê±´
$users = db()->select('*')
    ->from('users')
    ->where('role = ?', ['admin'])
    ->orWhere('role = ?', ['moderator'])
    ->get();

// ë³µì¡í•œ ì¡°ê±´
$users = db()->select('*')
    ->from('users')
    ->where('(age > ? AND status = ?)', [18, 'active'])
    ->orWhere('role = ?', ['admin'])
    ->get();
```

### JOIN ì‘ì—…

```php
// INNER JOIN
$results = db()->select('users.*, posts.title')
    ->from('users')
    ->join('posts', 'users.id = posts.user_id')
    ->get();

// LEFT JOIN
$results = db()->select('users.*, COUNT(posts.id) as post_count')
    ->from('users')
    ->join('posts', 'users.id = posts.user_id', 'LEFT')
    ->get();

// ì—¬ëŸ¬ JOIN
$results = db()->select('u.first_name, u.last_name, p.title, c.comment')
    ->from('users u')
    ->join('posts p', 'u.id = p.user_id')
    ->join('comments c', 'p.id = c.post_id', 'LEFT')
    ->where('u.status = ?', ['active'])
    ->get();
```

### ORDER BY

```php
// ë‹¨ì¼ ì»¬ëŸ¼ ì •ë ¬
$users = db()->select('*')
    ->from('users')
    ->orderBy('created_at', 'DESC')
    ->get();

// ì—¬ëŸ¬ ì»¬ëŸ¼ ì •ë ¬
$users = db()->select('*')
    ->from('users')
    ->orderBy('status', 'ASC')
    ->orderBy('created_at', 'DESC')
    ->get();

// ë‹¤ë¥¸ ì ˆê³¼ í•¨ê»˜ ì •ë ¬
$users = db()->select('*')
    ->from('users')
    ->where('status = ?', ['active'])
    ->orderBy('last_name', 'ASC')
    ->orderBy('first_name', 'ASC')
    ->limit(10)
    ->get();
```

### LIMIT ë° í˜ì´ì§€ë„¤ì´ì…˜

```php
// ë‹¨ìˆœ limit
$users = db()->select('*')
    ->from('users')
    ->limit(10)
    ->get();

// í˜ì´ì§€ë„¤ì´ì…˜ì„ ìœ„í•œ offsetì´ ìˆëŠ” limit
$page = 2;
$perPage = 10;
$offset = ($page - 1) * $perPage;

$users = db()->select('*')
    ->from('users')
    ->limit($perPage, $offset)
    ->get();

// í˜ì´ì§€ë„¤ì´ì…˜ì„ ìœ„í•œ ì „ì²´ ìˆ˜ ê°€ì ¸ì˜¤ê¸°
$total = db()->select()->from('users')->count();
$totalPages = ceil($total / $perPage);
```

### íŠ¸ëœì­ì…˜

```php
try {
    db()->beginTransaction();

    // ì‚¬ìš©ì ì‚½ì…
    $userId = db()->insert([
        'first_name' => 'John',
        'last_name' => 'Doe',
        'email' => 'john@example.com'
    ])->into('users');

    // ê´€ë ¨ í”„ë¡œí•„ ì‚½ì…
    db()->insert([
        'user_id' => $userId,
        'bio' => 'Software Developer'
    ])->into('profiles');

    // í†µê³„ ì—…ë°ì´íŠ¸
    db()->update(['user_count' => db()->query("SELECT COUNT(*) FROM users")[0]['COUNT(*)']])
        ->table('stats')
        ->where('id = 1')
        ->execute();

    db()->commit();
    echo "íŠ¸ëœì­ì…˜ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤";

} catch (Exception $e) {
    db()->rollback();
    echo "íŠ¸ëœì­ì…˜ ì‹¤íŒ¨: " . $e->getMessage();
}
```

## ì—”í‹°í‹° ì‹œìŠ¤í…œ

ì—”í‹°í‹° ì‹œìŠ¤í…œì€ ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ ë¹Œë” ìœ„ì— ê°ì²´ ì§€í–¥ ë ˆì´ì–´ë¥¼ ì œê³µí•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ ë ˆì½”ë“œë¥¼ ê°ì²´ë¡œ ì‘ì—…í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤. ê° ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì€ ê¸°ë³¸ Entity í´ë˜ìŠ¤ë¥¼ í™•ì¥í•˜ëŠ” Entity í´ë˜ìŠ¤ë¡œ í‘œí˜„ë©ë‹ˆë‹¤.

### ì—”í‹°í‹° ê¸°ë³¸ í´ë˜ìŠ¤

`Entity` í´ë˜ìŠ¤ (`/lib/db/entity.php`)ëŠ” ëª¨ë“  ì—”í‹°í‹° í´ë˜ìŠ¤ì˜ ê¸°ë°˜ì„ ì œê³µí•©ë‹ˆë‹¤:

#### ì£¼ìš” ê¸°ëŠ¥
- `id`, `created_at`, `updated_at` í•„ë“œì˜ ìë™ ì²˜ë¦¬
- **ì¤‘ìš”**: ëª¨ë“  íƒ€ì„ìŠ¤íƒ¬í”„ í•„ë“œ (`created_at`, `updated_at` ë“±)ëŠ” Unix íƒ€ì„ìŠ¤íƒ¬í”„(ì •ìˆ˜ ê°’)ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤
- CRUD ì‘ì—…: `get()`, `create()`, `update()`, `delete()`
- ë§¤ì§ getter/setterê°€ ìˆëŠ” `$data` ë°°ì—´ì— ë°ì´í„° ì €ì¥
- ë ˆì½”ë“œ ì¿¼ë¦¬ë¥¼ ìœ„í•œ find ë©”ì„œë“œ
- ë‚´ì¥ ìœ íš¨ì„± ê²€ì‚¬ ë° ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§

#### ê¸°ë³¸ ì—”í‹°í‹° ë©”ì„œë“œ

```php
// IDë¡œ ì—”í‹°í‹° ê°€ì ¸ì˜¤ê¸°
$entity = EntityClass::get($id);

// ìƒˆ ì—”í‹°í‹° ìƒì„±
$entity = EntityClass::create(['field' => 'value']);

// ì—”í‹°í‹° ì—…ë°ì´íŠ¸
$entity->update(['field' => 'new value']);

// ì—”í‹°í‹° ì‚­ì œ
$entity->delete();

// ì—”í‹°í‹° ì°¾ê¸°
$entities = EntityClass::find(['status' => 'active']);
$entity = EntityClass::findFirst(['email' => 'user@example.com']);

// ëª¨ë“  ì—”í‹°í‹° ê°€ì ¸ì˜¤ê¸°
$all = EntityClass::all();

// ì—”í‹°í‹° ìˆ˜ ì„¸ê¸°
$count = EntityClass::count(['status' => 'active']);

// ì—”í‹°í‹° ì¡´ì¬ ì—¬ë¶€ í™•ì¸
$exists = EntityClass::exists($id);
```

### ì—”í‹°í‹° í´ë˜ìŠ¤ ìƒì„±

ìƒˆ ì—”í‹°í‹° í´ë˜ìŠ¤ë¥¼ ìƒì„±í•˜ë ¤ë©´ ê¸°ë³¸ `Entity` í´ë˜ìŠ¤ë¥¼ í™•ì¥í•˜ê³  í…Œì´ë¸” ì´ë¦„ì„ ì •ì˜í•˜ì„¸ìš”:

```php
class Product extends Entity {
    protected static $table = 'products';

    // ì—”í‹°í‹°ì— íŠ¹ì •í•œ ì‚¬ìš©ì ì •ì˜ ë©”ì„œë“œ ì¶”ê°€
    public function getPrice() {
        return $this->getValue('price');
    }

    public function isInStock() {
        return $this->getValue('stock_quantity', 0) > 0;
    }
}
```

### ì—”í‹°í‹° CRUD ì‘ì—…

#### Create (ìƒì„±)
```php
// ìœ íš¨ì„± ê²€ì‚¬ì™€ í•¨ê»˜ ìƒì„±
$user = User::create([
    'firebase_uid' => 'firebase_uid_abc123',
    'phone_number' => '+1234567890',
    'first_name' => 'John',
    'last_name' => 'Doe'
]);

// ìƒì„±ëœ ì—”í‹°í‹° ë°ì´í„°ì— ì ‘ê·¼
echo $user->getValue('id');           // ìë™ ìƒì„±ëœ ID
echo $user->getValue('created_at');   // Unix íƒ€ì„ìŠ¤íƒ¬í”„ (ì˜ˆ: 1735030800)
```

#### Read (ì½ê¸°)
```php
// IDë¡œ ê°€ì ¸ì˜¤ê¸°
$user = User::get(1);

// find ë©”ì„œë“œ
$user = User::findByEmail('john@example.com');
$users = User::find(['status' => 'active'], 10); // ìµœëŒ€ 10ê°œ
$first = User::findFirst(['role' => 'admin']);

// ë§¤ì§ getter
echo $user->first_name;    // getValue('first_name')ì™€ ë™ì¼
echo $user->last_name;     // getValue('last_name')ì™€ ë™ì¼
echo $user->email;
```

#### Update (ì—…ë°ì´íŠ¸)
```php
// ì—”í‹°í‹° ì—…ë°ì´íŠ¸
$user->update(['first_name' => 'Jane', 'last_name' => 'Doe']);

// ë§¤ì§ setter ì‚¬ìš©
$user->first_name = 'New';
$user->last_name = 'Name';
$user->save();

// ëŒ€ëŸ‰ ì—…ë°ì´íŠ¸
$user->setData([
    'first_name' => 'Updated',
    'last_name' => 'Name',
    'email' => 'new@example.com'
]);
$user->save();
```

#### Delete (ì‚­ì œ)
```php
// ì¸ìŠ¤í„´ìŠ¤ ì‚­ì œ
$user->delete();

// IDë¡œ ì •ì  ì‚­ì œ
User::destroy($id);
```

### ì‚¬ìš©ì ì—”í‹°í‹°

`User` í´ë˜ìŠ¤ (`/lib/db/user.php`)ëŠ” ì‚¬ìš©ìë³„ ê¸°ëŠ¥ìœ¼ë¡œ Entityë¥¼ í™•ì¥í•©ë‹ˆë‹¤:

```php
// Firebase ì „í™” ì¸ì¦ìœ¼ë¡œ ì‚¬ìš©ì ìƒì„±
$user = User::create([
    'firebase_uid' => 'firebase_uid_123',
    'phone_number' => '+1234567890',
    'first_name' => 'John',
    'last_name' => 'Doe'
]);

// ì‚¬ìš©ì ì°¾ê¸°
$user = User::findByFirebaseUid('firebase_uid_123');
$user = User::findByPhoneNumber('+1234567890');
// ì‚¬ìš©ì ìƒì„± ë˜ëŠ” ê°€ì ¸ì˜¤ê¸° (Firebase ì¸ì¦ íë¦„ì— ìœ ìš©)
$user = User::createOrGetByFirebaseUid(
    'firebase_uid_123',
    '+1234567890',
    ['first_name' => 'John', 'last_name' => 'Doe'] // ì„ íƒì  ì¶”ê°€ ë°ì´í„°
);

// ìƒíƒœ ê´€ë¦¬
if ($user->isActive()) {
    $user->deactivate();
}
$user->activate();

// ì‚¬ìš©ìì˜ ê²Œì‹œë¬¼ ê°€ì ¸ì˜¤ê¸°
$posts = $user->getPosts(10); // ìµœëŒ€ 10ê°œ

// í™œì„±/ë¹„í™œì„± ì‚¬ìš©ì ê°€ì ¸ì˜¤ê¸°
$activeUsers = User::getActiveUsers();
$inactiveUsers = User::getInactiveUsers();
```

### ê²Œì‹œë¬¼ ì—”í‹°í‹°

`Post` í´ë˜ìŠ¤ (`/lib/db/post.php`)ëŠ” ê²Œì‹œë¬¼/ê¸°ì‚¬ ê¸°ëŠ¥ìœ¼ë¡œ Entityë¥¼ í™•ì¥í•©ë‹ˆë‹¤:

```php
// ê²Œì‹œë¬¼ ìƒì„±
$post = Post::create([
    'user_id' => 1,
    'title' => 'My First Post',
    'content' => 'Post content here...',
    'status' => 'draft' // ì„ íƒ ì‚¬í•­, ê¸°ë³¸ê°’ì€ 'draft'
]);

// ê²Œì‹œë¬¼ ì°¾ê¸°
$post = Post::findBySlug('my-first-post'); // ìë™ ìƒì„±ëœ slug
$posts = Post::getByUser($userId);
$published = Post::getPublished(10); // ìµœëŒ€ 10ê°œ
$drafts = Post::getDrafts();

// ê²Œì‹œë¬¼ ê´€ë¦¬
$post->publish();  // ìƒíƒœë¥¼ 'published'ë¡œ ì„¤ì •
$post->unpublish(); // ìƒíƒœë¥¼ 'draft'ë¡œ ì„¤ì •

// ì¡°íšŒìˆ˜ ì¶”ì 
$post->incrementViewCount();
echo $post->getViewCount();

// ì‘ì„±ì ê°€ì ¸ì˜¤ê¸°
$author = $post->getAuthor(); // User ì—”í‹°í‹° ë°˜í™˜

// ì½˜í…ì¸  í—¬í¼
echo $post->getTitle();
echo $post->getExcerpt(150); // ì²« 150ì

// ê²Œì‹œë¬¼ ê²€ìƒ‰
$results = Post::search('keyword', 20); // ì œí•œê³¼ í•¨ê»˜ ê²€ìƒ‰

// ìµœê·¼ ê²Œì‹œë¬¼ ê°€ì ¸ì˜¤ê¸°
$recent = Post::getRecent(5); // ê°€ì¥ ìµœê·¼ ê²Œì‹œëœ ê²Œì‹œë¬¼ 5ê°œ
```

### ì—”í‹°í‹° ë§¤ì§ ë©”ì„œë“œ

ëª¨ë“  ì—”í‹°í‹°ëŠ” í¸ë¦¬í•œ ì†ì„± ì ‘ê·¼ì„ ìœ„í•œ ë§¤ì§ ë©”ì„œë“œë¥¼ ì§€ì›í•©ë‹ˆë‹¤:

```php
$user = User::get(1);

// ë§¤ì§ getter
echo $user->first_name;       // getValue('first_name')ì™€ ë™ì¼
echo $user->last_name;        // getValue('last_name')ì™€ ë™ì¼

// ë§¤ì§ setter
$user->first_name = 'New';    // setValue('first_name', 'New')ì™€ ë™ì¼
$user->last_name = 'Name';    // setValue('last_name', 'Name')ì™€ ë™ì¼

// ë§¤ì§ isset
if (isset($user->email)) {
    echo "ì´ë©”ì¼ì´ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤";
}

// ë§¤ì§ unset
unset($user->temporary_field);
```

### ì—”í‹°í‹° ìœ í‹¸ë¦¬í‹°

```php
// ë°°ì—´ë¡œ ë³€í™˜
$array = $user->toArray();

// JSONìœ¼ë¡œ ë³€í™˜
$json = $user->toJson();

// ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ìƒˆë¡œ ê³ ì¹¨
$user->refresh();

// ëª¨ë“  ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
$data = $user->getData();

// ì¡´ì¬ ì—¬ë¶€ í™•ì¸
if (User::exists($id)) {
    echo "ì‚¬ìš©ìê°€ ì¡´ì¬í•©ë‹ˆë‹¤";
}

// ë ˆì½”ë“œ ìˆ˜ ì„¸ê¸°
$total = User::count();
$active = User::count(['status' => 'active']);
```

### ì—”í‹°í‹° ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸

ì—”í‹°í‹° ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰:

```bash
php tests/db/entity.test.php
```

í…ŒìŠ¤íŠ¸ ìŠ¤ìœ„íŠ¸ëŠ” ë‹¤ìŒì„ ë‹¤ë£¹ë‹ˆë‹¤:
- ì—”í‹°í‹° CRUD ì‘ì—…
- ì‚¬ìš©ì ì—”í‹°í‹° ê¸°ëŠ¥
- ê²Œì‹œë¬¼ ì—”í‹°í‹° ê¸°ëŠ¥
- ë§¤ì§ ë©”ì„œë“œ
- ì—”í‹°í‹° ê°„ ê´€ê³„
- ìœ íš¨ì„± ê²€ì‚¬ ë° ì˜¤ë¥˜ ì²˜ë¦¬

## ë©”ì„œë“œ ì°¸ì¡°

### ì¿¼ë¦¬ ë¹Œë”© ë©”ì„œë“œ

| ë©”ì„œë“œ | ì„¤ëª… | ë°˜í™˜ê°’ |
|--------|-------------|---------|
| `select($fields)` | SELECT ì¿¼ë¦¬ ì‹œì‘ | `$this` |
| `insert($data)` | INSERT ì¿¼ë¦¬ ì‹œì‘ | `$this` |
| `update($data)` | UPDATE ì¿¼ë¦¬ ì‹œì‘ | `$this` |
| `delete()` | DELETE ì¿¼ë¦¬ ì‹œì‘ | `$this` |
| `table($table)` | í…Œì´ë¸” ì´ë¦„ ì„¤ì • | `$this` |
| `from($table)` | `table()`ì˜ ë³„ì¹­ | `$this` |
| `into($table)` | í…Œì´ë¸” ì„¤ì • ë° INSERT ì‹¤í–‰ | `int` (ì‚½ì… ID) ë˜ëŠ” `$this` |
| `where($condition, $params)` | WHERE ì¡°ê±´ ì¶”ê°€ | `$this` |
| `orWhere($condition, $params)` | OR WHERE ì¡°ê±´ ì¶”ê°€ | `$this` |
| `join($table, $on, $type)` | JOIN ì ˆ ì¶”ê°€ | `$this` |
| `orderBy($field, $direction)` | ORDER BY ì¶”ê°€ | `$this` |
| `limit($limit, $offset)` | LIMIT ì ˆ ì¶”ê°€ | `$this` |

### ì‹¤í–‰ ë©”ì„œë“œ

| ë©”ì„œë“œ | ì„¤ëª… | ë°˜í™˜ê°’ |
|--------|-------------|---------|
| `get()` | SELECT ì‹¤í–‰ ë° ëª¨ë“  ê²°ê³¼ ë°˜í™˜ | `array` |
| `first()` | SELECT ì‹¤í–‰ ë° ì²« ë²ˆì§¸ ê²°ê³¼ ë°˜í™˜ | `array\|null` |
| `count()` | SELECT ì‹¤í–‰ ë° ìˆ˜ ë°˜í™˜ | `int` |
| `execute()` | ë¹Œë“œëœ ì¿¼ë¦¬ ì‹¤í–‰ | `mixed` |
| `query($sql, $params)` | ì›ì‹œ SQL ì¿¼ë¦¬ ì‹¤í–‰ | `mixed` |

### íŠ¸ëœì­ì…˜ ë©”ì„œë“œ

| ë©”ì„œë“œ | ì„¤ëª… | ë°˜í™˜ê°’ |
|--------|-------------|---------|
| `beginTransaction()` | íŠ¸ëœì­ì…˜ ì‹œì‘ | `void` |
| `commit()` | íŠ¸ëœì­ì…˜ ì»¤ë°‹ | `void` |
| `rollback()` | íŠ¸ëœì­ì…˜ ë¡¤ë°± | `void` |

## ì˜ˆì œ

### ì‚¬ìš©ì ë“±ë¡ ì˜ˆì œ

```php
// ì´ë©”ì¼ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
$existing = db()->select('id')
    ->from('users')
    ->where('email = ?', [$email])
    ->first();

if ($existing) {
    throw new Exception('ì´ë©”ì¼ì´ ì´ë¯¸ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤');
}

// ìƒˆ ì‚¬ìš©ì ì‚½ì…
$userId = db()->insert([
    'first_name' => $firstName,
    'last_name' => $lastName,
    'email' => $email,
    'password_hash' => password_hash($password, PASSWORD_DEFAULT),
    'created_at' => date('Y-m-d H:i:s')
])->into('users');

// ì‚¬ìš©ì í”„ë¡œí•„ ìƒì„±
db()->insert([
    'user_id' => $userId,
    'avatar' => '/default-avatar.png'
])->into('profiles');
```

### ëŒ“ê¸€ì´ ìˆëŠ” ë¸”ë¡œê·¸ ê²Œì‹œë¬¼ ì˜ˆì œ

```php
// ì‘ì„±ì ë° ëŒ“ê¸€ ìˆ˜ì™€ í•¨ê»˜ ê²Œì‹œë¬¼ ê°€ì ¸ì˜¤ê¸°
$post = db()->query("
    SELECT
        p.*,
        u.first_name,
        u.last_name,
        COUNT(c.id) as comment_count
    FROM posts p
    JOIN users u ON p.user_id = u.id
    LEFT JOIN comments c ON p.id = c.post_id
    WHERE p.id = ? AND p.status = 'published'
    GROUP BY p.id
", [$postId])[0];

// ê²Œì‹œë¬¼ì˜ ëŒ“ê¸€ ê°€ì ¸ì˜¤ê¸°
$comments = db()->select('c.*, u.first_name, u.last_name')
    ->from('comments c')
    ->join('users u', 'c.user_id = u.id')
    ->where('c.post_id = ?', [$postId])
    ->orderBy('c.created_at', 'DESC')
    ->limit(10)
    ->get();
```

### í˜ì´ì§€ë„¤ì´ì…˜ì´ ìˆëŠ” ê²€ìƒ‰ ì˜ˆì œ

```php
function searchUsers($keyword, $page = 1, $perPage = 20) {
    $offset = ($page - 1) * $perPage;

    // ì „ì²´ ìˆ˜ ê°€ì ¸ì˜¤ê¸°
    $total = db()->select()
        ->from('users')
        ->where('first_name LIKE ? OR last_name LIKE ? OR email LIKE ?', ["%$keyword%", "%$keyword%", "%$keyword%"])
        ->count();

    // í˜ì´ì§€ë„¤ì´ì…˜ëœ ê²°ê³¼ ê°€ì ¸ì˜¤ê¸°
    $users = db()->select('*')
        ->from('users')
        ->where('first_name LIKE ? OR last_name LIKE ? OR email LIKE ?', ["%$keyword%", "%$keyword%", "%$keyword%"])
        ->orderBy('last_name', 'ASC')
        ->orderBy('first_name', 'ASC')
        ->limit($perPage, $offset)
        ->get();

    return [
        'users' => $users,
        'total' => $total,
        'pages' => ceil($total / $perPage),
        'current_page' => $page
    ];
}
```

## ëª¨ë²” ì‚¬ë¡€

1. **í•­ìƒ prepared statement ì‚¬ìš©** - SQL ì¸ì ì…˜ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ì‚¬ìš©ì ì…ë ¥ì— í”Œë ˆì´ìŠ¤í™€ë”(?)ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”
2. **ê´€ë ¨ ì‘ì—…ì—ëŠ” íŠ¸ëœì­ì…˜ ì‚¬ìš©** - í•¨ê»˜ ì„±ê³µí•˜ê±°ë‚˜ ì‹¤íŒ¨í•´ì•¼ í•˜ëŠ” ì‘ì—…
3. **SELECT í•„ë“œ ì œí•œ** - `*` ëŒ€ì‹  í•„ìš”í•œ ì»¬ëŸ¼ë§Œ ì„ íƒí•˜ì„¸ìš”
4. **ì¸ë±ìŠ¤ ì¶”ê°€** - WHERE, ORDER BY ë° JOIN ì ˆì— ì‚¬ìš©ë˜ëŠ” ì»¬ëŸ¼ì—
5. **ë‹¨ì¼ ê²°ê³¼ë¥¼ ì˜ˆìƒí•  ë•ŒëŠ” `first()` ì‚¬ìš©** - `get()[0]` ëŒ€ì‹ 
6. **ë°˜í™˜ ê°’ í™•ì¸** - INSERTëŠ” IDë¥¼ ë°˜í™˜í•˜ê³ , UPDATE/DELETEëŠ” ì˜í–¥ì„ ë°›ì€ í–‰ì„ ë°˜í™˜í•©ë‹ˆë‹¤
7. **ì—°ê²° ë‹«ê¸°** - ì¥ê¸° ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ ì‘ì—…ì´ ì™„ë£Œë˜ë©´ `db_close()`ë¥¼ í˜¸ì¶œí•˜ì„¸ìš”


## ì½”ë©˜íŠ¸ í…Œì´ë¸” ì„¤ëª…

í…Œì´ë¸” êµ¬ì¡° ì„¤ëª…:

id: Primary Key (ìë™ ì¦ê°€)
post_id: posts í…Œì´ë¸”ì˜ idë¥¼ ì°¸ì¡° (ì™¸ë˜í‚¤ ê´€ê³„ì´ì§€ë§Œ ì‹¤ì œ ì œì•½ì€ ì—†ìŒ)
user_id: users í…Œì´ë¸”ì˜ idë¥¼ ì°¸ì¡° (ì™¸ë˜í‚¤ ê´€ê³„ì´ì§€ë§Œ ì‹¤ì œ ì œì•½ì€ ì—†ìŒ)
parent_id: ë¶€ëª¨ ëŒ“ê¸€ ID (0ì´ë©´ ìµœìƒìœ„ ëŒ“ê¸€, 0ë³´ë‹¤ í¬ë©´ ë‹µê¸€)
content: LONGTEXT íƒ€ì…ìœ¼ë¡œ ëŒ“ê¸€ ë‚´ìš© ì €ì¥
files: TEXT íƒ€ì…ìœ¼ë¡œ íŒŒì¼ ì •ë³´ ì €ì¥
comment_count: ì§ì ‘ ìì‹ ëŒ“ê¸€ ìˆ˜ (1ë‹¨ê³„ í•˜ìœ„ ëŒ“ê¸€ë§Œ ì¹´ìš´íŠ¸, ì†ìëŠ” í¬í•¨ ì•ˆ ë¨)
depth: ëŒ“ê¸€ ê¹Šì´ (0: ìµœìƒìœ„ ëŒ“ê¸€, 1: ë‹µê¸€, 2: ë‹µê¸€ì˜ ë‹µê¸€, ...)
sort: ëŒ“ê¸€ ì •ë ¬ ìˆœì„œ ë¬¸ìì—´
created_at: ìƒì„± ì‹œê°„ (UNIX timestamp)
updated_at: ìˆ˜ì • ì‹œê°„ (UNIX timestamp)

ì¸ë±ìŠ¤:

id: Primary Key
post_id: íŠ¹ì • ê²Œì‹œê¸€ì˜ ëŒ“ê¸€ì„ ë¹ ë¥´ê²Œ ì¡°íšŒí•˜ê¸° ìœ„í•œ ì¸ë±ìŠ¤
user_id: íŠ¹ì • ì‚¬ìš©ìì˜ ëŒ“ê¸€ì„ ë¹ ë¥´ê²Œ ì¡°íšŒí•˜ê¸° ìœ„í•œ ì¸ë±ìŠ¤

### `comment_count` í•„ë“œ

**ëª©ì **: ê° ëŒ“ê¸€ì˜ ì§ì ‘ ìì‹ ëŒ“ê¸€ ìˆ˜ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.

**ì¤‘ìš” ì‚¬í•­**:
- **ì§ì ‘ ìì‹ë§Œ ì¹´ìš´íŠ¸**: 1ë‹¨ê³„ í•˜ìœ„ ëŒ“ê¸€ë§Œ ê³„ì‚°í•˜ë©°, ì†ì ëŒ“ê¸€ì€ í¬í•¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤
- **DBì— ì €ì¥**: ë™ì ìœ¼ë¡œ ê³„ì‚°í•˜ì§€ ì•Šê³  DB í•„ë“œì— ì €ì¥ë©ë‹ˆë‹¤
- **ìë™ ì—…ë°ì´íŠ¸**: ëŒ“ê¸€ ìƒì„±/ì‚­ì œ ì‹œ ìë™ìœ¼ë¡œ ë¶€ëª¨ ëŒ“ê¸€ì˜ `comment_count`ê°€ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤

**ìë™ ì—…ë°ì´íŠ¸ ë¡œì§**:

1. **`create_comment()` í•¨ìˆ˜**:
   - ëŒ“ê¸€ ìƒì„± í›„ `parent_id`ê°€ 0ë³´ë‹¤ í¬ë©´ (ë‹µê¸€ì¸ ê²½ìš°)
   - ë¶€ëª¨ ëŒ“ê¸€ì˜ `comment_count`ë¥¼ ìë™ ì¦ê°€

2. **`delete_comment()` í•¨ìˆ˜**:
   - ëŒ“ê¸€ ì‚­ì œ í›„ `parent_id`ê°€ 0ë³´ë‹¤ í¬ë©´ (ë‹µê¸€ì¸ ê²½ìš°)
   - ë¶€ëª¨ ëŒ“ê¸€ì˜ `comment_count`ë¥¼ ìë™ ê°ì†Œ

3. **`update_comment_child_count()` í—¬í¼ í•¨ìˆ˜**:
   - íŠ¹ì • ëŒ“ê¸€ì˜ ì§ì ‘ ìì‹ ìˆ˜ë¥¼ ì¬ê³„ì‚°í•˜ì—¬ DBì— ì—…ë°ì´íŠ¸
   - `create_comment()`ì™€ `delete_comment()`ì—ì„œ ìë™ í˜¸ì¶œë¨

**ì˜ˆì‹œ**:

```
ìµœìƒìœ„ ëŒ“ê¸€ (comment_count = 3)
  â”œâ”€ ë‹µê¸€ 1 (comment_count = 2)
  â”‚   â”œâ”€ ë‹µê¸€ 1-1 (comment_count = 0)
  â”‚   â””â”€ ë‹µê¸€ 1-2 (comment_count = 0)
  â”œâ”€ ë‹µê¸€ 2 (comment_count = 0)
  â””â”€ ë‹µê¸€ 3 (comment_count = 1)
      â””â”€ ë‹µê¸€ 3-1 (comment_count = 0)
```

ìœ„ êµ¬ì¡°ì—ì„œ:
- ìµœìƒìœ„ ëŒ“ê¸€ì˜ `comment_count` = 3 (ì§ì ‘ ìì‹: ë‹µê¸€ 1, 2, 3)
- ë‹µê¸€ 1ì˜ `comment_count` = 2 (ì§ì ‘ ìì‹: ë‹µê¸€ 1-1, 1-2)
- ë‹µê¸€ 3ì˜ `comment_count` = 1 (ì§ì ‘ ìì‹: ë‹µê¸€ 3-1)
- ë‚˜ë¨¸ì§€ ëŒ“ê¸€ë“¤ì€ `comment_count` = 0 (ìì‹ ì—†ìŒ)

**ì‚¬ìš© ë°©ë²•**:

```php
// get_comments()ë¡œ ëŒ“ê¸€ ê°€ì ¸ì˜¤ê¸° - comment_count í¬í•¨ë¨
$comments = get_comments(['post_id' => 123]);

foreach ($comments as $comment) {
    echo "ëŒ“ê¸€ ID: {$comment->id}\n";
    echo "ìì‹ ëŒ“ê¸€ ìˆ˜: {$comment->comment_count}\n";
}
```

**í…ŒìŠ¤íŠ¸ íŒŒì¼**: `tests/comment/comment-count-db.test.php`

**ê´€ë ¨ í•¨ìˆ˜**:
- `update_comment_child_count(int $comment_id)`: íŠ¹ì • ëŒ“ê¸€ì˜ ìì‹ ìˆ˜ ì¬ê³„ì‚°
- `create_comment(array $input)`: ëŒ“ê¸€ ìƒì„± ì‹œ ë¶€ëª¨ì˜ count ìë™ ì¦ê°€
- `delete_comment(array $input)`: ëŒ“ê¸€ ì‚­ì œ ì‹œ ë¶€ëª¨ì˜ count ìë™ ê°ì†Œ
- `get_comment(array $input)`: ëŒ“ê¸€ ì¡°íšŒ ì‹œ comment_count í¬í•¨
- `get_comments(array $input)`: ëŒ“ê¸€ ëª©ë¡ ì¡°íšŒ ì‹œ comment_count í¬í•¨
created_at: ì‹œê°„ìˆœ ì •ë ¬ì„ ìœ„í•œ ì¸ë±ìŠ¤